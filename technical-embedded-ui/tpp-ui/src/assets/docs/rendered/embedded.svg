<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1791px" preserveAspectRatio="none" style="width:3636px;height:1791px;" version="1.1" viewBox="0 0 3636 1791" width="3636px" zoomAndPan="magnify"><defs><filter height="300%" id="flspqo0egx6fa" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="1733.0391" style="stroke: #A80036; stroke-width: 1.0;" width="951.5" x="527" y="47.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="53" x="976.25" y="59.3638">TPP API</text><rect fill="#DDDDDD" height="1733.0391" style="stroke: #A80036; stroke-width: 1.0;" width="875" x="1480.5" y="47.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="92" x="1872" y="59.3638">OPBA-Facade</text><rect fill="#DDDDDD" height="1733.0391" style="stroke: #A80036; stroke-width: 1.0;" width="1206.5" x="2357.5" y="47.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="2911.25" y="59.3638">XS2A-Protocol</text><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="1432.9141" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="465" y="243.125"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="1412.7813" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="803" y="272.2578"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="609.1953" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="808" y="1037.7109"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1381" y="1066.8438"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1381" y="1588.6406"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="1258.1172" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1537.5" y="301.3906"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1639.5" y="417.9219"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1639.5" y="476.1875"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1639.5" y="664.9844"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1639.5" y="950.3125"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1788.5" y="330.5234"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="145.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2047.5" y="388.7891"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2147.5" y="563.5859"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="87.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2266.5" y="921.1797"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2266.5" y="1501.2422"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="270.1953" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2455" y="621.8516"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="117.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2455" y="1354.7109"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="168.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="3187.5" y="635.8516"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="178.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="3187.5" y="1206.1797"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="3491.5" y="833.7813"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="3491.5" y="1413.8438"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="3589.5" y="1296.4453"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="1036.4531" style="stroke: #000000; stroke-width: 2.0;" width="3567" x="13" y="189.7266"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="510.0625" style="stroke: #000000; stroke-width: 2.0;" width="3547" x="23" y="709.1172"/><rect fill="#FFFFFF" height="56.9375" style="stroke: none; stroke-width: 1.0;" width="3547" x="23" y="1162.2422"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="51" x2="51" y1="129.5938" y2="1694.0391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="470" x2="470" y1="129.5938" y2="1694.0391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="622" x2="622" y1="129.5938" y2="1694.0391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="808" x2="808" y1="129.5938" y2="1694.0391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1385.5" x2="1385.5" y1="129.5938" y2="1694.0391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1542.5" x2="1542.5" y1="129.5938" y2="1694.0391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1644.5" x2="1644.5" y1="129.5938" y2="1694.0391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1793" x2="1793" y1="129.5938" y2="1694.0391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2052.5" x2="2052.5" y1="129.5938" y2="1694.0391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2152.5" x2="2152.5" y1="129.5938" y2="1694.0391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2271.5" x2="2271.5" y1="129.5938" y2="1694.0391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2459.5" x2="2459.5" y1="129.5938" y2="1694.0391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2659.5" x2="2659.5" y1="129.5938" y2="1694.0391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2848.5" x2="2848.5" y1="129.5938" y2="1694.0391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3037.5" x2="3037.5" y1="129.5938" y2="1694.0391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3192.5" x2="3192.5" y1="129.5938" y2="1694.0391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3496" x2="3496" y1="129.5938" y2="1694.0391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3594" x2="3594" y1="129.5938" y2="1694.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="33" y="126.292">User</text><ellipse cx="51" cy="56.2969" fill="#FEFECE" filter="url(#flspqo0egx6fa)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M51,64.2969 L51,91.2969 M38,72.2969 L64,72.2969 M51,91.2969 L38,106.2969 M51,91.2969 L64,106.2969 " fill="none" filter="url(#flspqo0egx6fa)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="33" y="1706.0342">User</text><ellipse cx="51" cy="1719.3359" fill="#FEFECE" filter="url(#flspqo0egx6fa)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M51,1727.3359 L51,1754.3359 M38,1735.3359 L64,1735.3359 M51,1754.3359 L38,1769.3359 M51,1754.3359 L64,1769.3359 " fill="none" filter="url(#flspqo0egx6fa)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="423" y="90.2969"/><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="419" y="94.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="426" y="114.292">TppBackend</text><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="423" y="1693.0391"/><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="419" y="1697.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="426" y="1717.0342">TppBackend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="177" x="531" y="126.292">TppBankingApiAisController</text><ellipse cx="622.5" cy="97.2969" fill="#FEFECE" filter="url(#flspqo0egx6fa)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="618.5,85.2969,624.5,80.2969,622.5,85.2969,624.5,90.2969,618.5,85.2969" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="177" x="531" y="1706.0342">TppBankingApiAisController</text><ellipse cx="622.5" cy="1725.3359" fill="#FEFECE" filter="url(#flspqo0egx6fa)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="618.5,1713.3359,624.5,1708.3359,622.5,1713.3359,624.5,1718.3359,618.5,1713.3359" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="162" x="724" y="126.292">ConsentServiceController</text><ellipse cx="808" cy="97.2969" fill="#FEFECE" filter="url(#flspqo0egx6fa)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="804,85.2969,810,80.2969,808,85.2969,810,90.2969,804,85.2969" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="162" x="724" y="1706.0342">ConsentServiceController</text><ellipse cx="808" cy="1725.3359" fill="#FEFECE" filter="url(#flspqo0egx6fa)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="804,1713.3359,810,1708.3359,808,1713.3359,810,1718.3359,804,1713.3359" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="173" x="1297.5" y="94.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="159" x="1304.5" y="114.292">FacadeResponseMapper</text><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="173" x="1297.5" y="1693.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="159" x="1304.5" y="1713.0342">FacadeResponseMapper</text><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="108" x="1488.5" y="90.2969"/><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="108" x="1484.5" y="94.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="1491.5" y="114.292">FacadeService</text><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="108" x="1488.5" y="1693.0391"/><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="108" x="1484.5" y="1697.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="1491.5" y="1717.0342">FacadeService</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="62" x="1610.5" y="126.292">Database</text><path d="M1626.5,77.2969 C1626.5,67.2969 1644.5,67.2969 1644.5,67.2969 C1644.5,67.2969 1662.5,67.2969 1662.5,77.2969 L1662.5,103.2969 C1662.5,113.2969 1644.5,113.2969 1644.5,113.2969 C1644.5,113.2969 1626.5,113.2969 1626.5,103.2969 L1626.5,77.2969 " fill="#FEFECE" filter="url(#flspqo0egx6fa)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1626.5,77.2969 C1626.5,87.2969 1644.5,87.2969 1644.5,87.2969 C1644.5,87.2969 1662.5,87.2969 1662.5,77.2969 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="62" x="1610.5" y="1706.0342">Database</text><path d="M1626.5,1719.3359 C1626.5,1709.3359 1644.5,1709.3359 1644.5,1709.3359 C1644.5,1709.3359 1662.5,1709.3359 1662.5,1719.3359 L1662.5,1745.3359 C1662.5,1755.3359 1644.5,1755.3359 1644.5,1755.3359 C1644.5,1755.3359 1626.5,1755.3359 1626.5,1745.3359 L1626.5,1719.3359 " fill="#FEFECE" filter="url(#flspqo0egx6fa)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1626.5,1719.3359 C1626.5,1729.3359 1644.5,1729.3359 1644.5,1729.3359 C1644.5,1729.3359 1662.5,1729.3359 1662.5,1719.3359 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="165" x="1709" y="94.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="151" x="1716" y="114.292">ServiceContextProvider</text><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="165" x="1709" y="1693.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="151" x="1716" y="1713.0342">ServiceContextProvider</text><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="1991.5" y="94.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="1998.5" y="114.292">ProtocolSelector</text><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="1991.5" y="1693.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="1998.5" y="1713.0342">ProtocolSelector</text><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="54" x="2123.5" y="94.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="2130.5" y="114.292">Spring</text><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="54" x="2123.5" y="1693.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="2130.5" y="1713.0342">Spring</text><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="156" x="2191.5" y="94.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="142" x="2198.5" y="114.292">ProtocolResultHandler</text><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="156" x="2191.5" y="1693.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="142" x="2198.5" y="1713.0342">ProtocolResultHandler</text><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="193" x="2361.5" y="94.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="179" x="2368.5" y="114.292">Xs2aListAccountsEntrypoint</text><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="193" x="2361.5" y="1693.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="179" x="2368.5" y="1713.0342">Xs2aListAccountsEntrypoint</text><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="178" x="2568.5" y="94.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="164" x="2575.5" y="114.292">Xs2aUpdateAuthorization</text><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="178" x="2568.5" y="1693.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="164" x="2575.5" y="1713.0342">Xs2aUpdateAuthorization</text><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="172" x="2760.5" y="94.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="158" x="2767.5" y="114.292">Xs2aFromAspspRedirect</text><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="172" x="2760.5" y="1693.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="158" x="2767.5" y="1713.0342">Xs2aFromAspspRedirect</text><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="178" x="2946.5" y="94.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="164" x="2953.5" y="114.292">Xs2aResultBodyExtractor</text><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="178" x="2946.5" y="1693.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="164" x="2953.5" y="1713.0342">Xs2aResultBodyExtractor</text><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="3142.5" y="90.2969"/><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="3138.5" y="94.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="3145.5" y="114.292">Xs2aServices</text><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="3142.5" y="1693.0391"/><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="3138.5" y="1697.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="3145.5" y="1717.0342">Xs2aServices</text><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="123" x="3433" y="94.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="109" x="3440" y="114.292">OutcomeMapper</text><rect fill="#FEFECE" filter="url(#flspqo0egx6fa)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="123" x="3433" y="1693.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="109" x="3440" y="1713.0342">OutcomeMapper</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="3571" y="126.292">ASPSP</text><path d="M3574,85.2969 L3574,109.2969 M3574,97.2969 L3591,97.2969 " fill="none" filter="url(#flspqo0egx6fa)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="3603" cy="97.2969" fill="#FEFECE" filter="url(#flspqo0egx6fa)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="3571" y="1706.0342">ASPSP</text><path d="M3574,1713.3359 L3574,1737.3359 M3574,1725.3359 L3591,1725.3359 " fill="none" filter="url(#flspqo0egx6fa)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="3603" cy="1725.3359" fill="#FEFECE" filter="url(#flspqo0egx6fa)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="1432.9141" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="465" y="243.125"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="1412.7813" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="803" y="272.2578"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="609.1953" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="808" y="1037.7109"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1381" y="1066.8438"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1381" y="1588.6406"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="1258.1172" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1537.5" y="301.3906"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1639.5" y="417.9219"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1639.5" y="476.1875"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1639.5" y="664.9844"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1639.5" y="950.3125"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1788.5" y="330.5234"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="145.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2047.5" y="388.7891"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2147.5" y="563.5859"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="87.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2266.5" y="921.1797"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2266.5" y="1501.2422"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="270.1953" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2455" y="621.8516"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="117.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2455" y="1354.7109"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="168.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="3187.5" y="635.8516"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="178.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="3187.5" y="1206.1797"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="3491.5" y="833.7813"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="3491.5" y="1413.8438"/><rect fill="#FFFFFF" filter="url(#flspqo0egx6fa)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="3589.5" y="1296.4453"/><rect fill="#EEEEEE" filter="url(#flspqo0egx6fa)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3621" x="3" y="160.1602"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3624" y1="160.1602" y2="160.1602"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3624" y1="163.1602" y2="163.1602"/><rect fill="#EEEEEE" filter="url(#flspqo0egx6fa)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="446" x="1590.5" y="149.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="428" x="1596.5" y="165.6606">User authorizes this request (embedded to provide i.e. PSU id)</text><path d="M13,189.7266 L87,189.7266 L87,196.7266 L77,206.7266 L13,206.7266 L13,189.7266 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1036.4531" style="stroke: #000000; stroke-width: 2.0;" width="3567" x="13" y="189.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="28" y="202.7935">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="256" x="102" y="201.937">[Until user input has not enough parameters]</text><polygon fill="#008000" points="453,239.125,463,243.125,453,247.125,457,243.125" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="51" x2="459" y1="243.125" y2="243.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="58" y="222.9263">POST /consent/embedded</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="395" x="58" y="238.0591">(Update context with 'Consent valid until', which accounts, etc.)</text><polygon fill="#008000" points="791,268.2578,801,272.2578,791,276.2578,795,272.2578" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="475" x2="797" y1="272.2578" y2="272.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="482" y="267.1919">embeddedUsingPOST</text><polygon fill="#008000" points="1525.5,297.3906,1535.5,301.3906,1525.5,305.3906,1529.5,301.3906" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="813" x2="1531.5" y1="301.3906" y2="301.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="820" y="296.3247">Facade.execute()</text><polygon fill="#008000" points="1776.5,326.5234,1786.5,330.5234,1776.5,334.5234,1780.5,330.5234" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1547.5" x2="1782.5" y1="330.5234" y2="330.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="222" x="1554.5" y="325.4575">Create facade context from request</text><polygon fill="#008000" points="1558.5,355.6563,1548.5,359.6563,1558.5,363.6563,1554.5,359.6563" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1552.5" x2="1792.5" y1="359.6563" y2="359.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="1564.5" y="354.5903">ServiceContext</text><polygon fill="#008000" points="2035.5,384.7891,2045.5,388.7891,2035.5,392.7891,2039.5,388.7891" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1547.5" x2="2041.5" y1="388.7891" y2="388.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="328" x="1554.5" y="383.7231">Select bank protocol by using authorization session id</text><polygon fill="#008000" points="1660.5,413.9219,1650.5,417.9219,1660.5,421.9219,1656.5,417.9219" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1654.5" x2="2046.5" y1="417.9219" y2="417.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="327" x="1666.5" y="412.856">Read authorization session using authId from request</text><polygon fill="#008000" points="2035.5,443.0547,2045.5,447.0547,2035.5,451.0547,2039.5,447.0547" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1644.5" x2="2041.5" y1="447.0547" y2="447.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="1651.5" y="441.9888">AuthorizationSession</text><polygon fill="#008000" points="1660.5,472.1875,1650.5,476.1875,1660.5,480.1875,1656.5,476.1875" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1654.5" x2="2046.5" y1="476.1875" y2="476.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="379" x="1666.5" y="471.1216">Read bank protocol using AuthorizationSession.bankProtocolId</text><polygon fill="#008000" points="2035.5,501.3203,2045.5,505.3203,2035.5,509.3203,2039.5,505.3203" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1644.5" x2="2041.5" y1="505.3203" y2="505.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="1651.5" y="500.2544">BankProtocol</text><polygon fill="#008000" points="1558.5,530.4531,1548.5,534.4531,1558.5,538.4531,1554.5,534.4531" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1552.5" x2="2051.5" y1="534.4531" y2="534.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="1564.5" y="529.3872">BankProtocol</text><polygon fill="#008000" points="2135.5,559.5859,2145.5,563.5859,2135.5,567.5859,2139.5,563.5859" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1547.5" x2="2141.5" y1="563.5859" y2="563.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="408" x="1554.5" y="558.52">Find bean - Bean(BankProtocol.protocolBeanName) extends Action</text><polygon fill="#008000" points="1558.5,588.7188,1548.5,592.7188,1558.5,596.7188,1554.5,592.7188" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1552.5" x2="2151.5" y1="592.7188" y2="592.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="262" x="1564.5" y="587.6528">It is Xs2aUpdateAuthorization service bean</text><polygon fill="#008000" points="2443,617.8516,2453,621.8516,2443,625.8516,2447,621.8516" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1547.5" x2="2449" y1="621.8516" y2="621.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="330" x="1554.5" y="616.7856">Xs2aListAccountsEntrypoint.execute(ServiceContext)</text><polygon fill="#008000" points="3175.5,631.8516,3185.5,635.8516,3175.5,639.8516,3179.5,635.8516" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="2465" x2="3181.5" y1="635.8516" y2="635.8516"/><polygon fill="#008000" points="1660.5,660.9844,1650.5,664.9844,1660.5,668.9844,1656.5,664.9844" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1654.5" x2="3186.5" y1="664.9844" y2="664.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1666.5" y="659.9185">Consent for service session</text><polygon fill="#008000" points="3175.5,690.1172,3185.5,694.1172,3175.5,698.1172,3179.5,694.1172" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1644.5" x2="3181.5" y1="694.1172" y2="694.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="1651.5" y="689.0513">No consent</text><path d="M23,709.1172 L86,709.1172 L86,716.1172 L76,726.1172 L23,726.1172 L23,709.1172 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="510.0625" style="stroke: #000000; stroke-width: 2.0;" width="3547" x="23" y="709.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="38" y="722.1841">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="182" x="101" y="721.3276">[User supplied not enough data]</text><line style="stroke: #008000; stroke-width: 1.0;" x1="3197.5" x2="3239.5" y1="762.5156" y2="762.5156"/><line style="stroke: #008000; stroke-width: 1.0;" x1="3239.5" x2="3239.5" y1="762.5156" y2="775.5156"/><line style="stroke: #008000; stroke-width: 1.0;" x1="3198.5" x2="3239.5" y1="775.5156" y2="775.5156"/><polygon fill="#008000" points="3208.5,771.5156,3198.5,775.5156,3208.5,779.5156,3204.5,775.5156" style="stroke: #008000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="3204.5" y="742.3169">Validate API input -</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="280" x="3204.5" y="757.4497">do we have enough data (Mocked execution)</text><polygon fill="#008000" points="2476,800.6484,2466,804.6484,2476,808.6484,2472,804.6484" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="2470" x2="3191.5" y1="804.6484" y2="804.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="336" x="2482" y="799.5825">ValidationIssue[] -&gt; User input has missing parameters</text><polygon fill="#008000" points="3479.5,829.7813,3489.5,833.7813,3479.5,837.7813,3483.5,833.7813" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="2465" x2="3485.5" y1="833.7813" y2="833.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="2472" y="828.7153">Translate ValidationIssue[]</text><polygon fill="#008000" points="2476,858.9141,2466,862.9141,2476,866.9141,2472,862.9141" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="2470" x2="3495.5" y1="862.9141" y2="862.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="2482" y="857.8481">ContextBasedValidationErrorResult</text><polygon fill="#008000" points="1558.5,888.0469,1548.5,892.0469,1558.5,896.0469,1554.5,892.0469" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1552.5" x2="2459" y1="892.0469" y2="892.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="1564.5" y="886.981">ContextBasedValidationErrorResult</text><polygon fill="#008000" points="2254.5,917.1797,2264.5,921.1797,2254.5,925.1797,2258.5,921.1797" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1547.5" x2="2260.5" y1="921.1797" y2="921.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="489" x="1554.5" y="916.1138">Translate ContextBasedValidationErrorResult -&gt; FacadeStartAuthorizationResult</text><polygon fill="#008000" points="1660.5,946.3125,1650.5,950.3125,1660.5,954.3125,1656.5,950.3125" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1654.5" x2="2265.5" y1="950.3125" y2="950.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="1666.5" y="945.2466">Authorization session present?</text><polygon fill="#008000" points="2254.5,975.4453,2264.5,979.4453,2254.5,983.4453,2258.5,979.4453" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1644.5" x2="2260.5" y1="979.4453" y2="979.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="1651.5" y="974.3794">AuthorizationSession</text><polygon fill="#008000" points="1558.5,1004.5781,1548.5,1008.5781,1558.5,1012.5781,1554.5,1008.5781" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1552.5" x2="2270.5" y1="1008.5781" y2="1008.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="1564.5" y="1003.5122">FacadeRedirectResult</text><polygon fill="#008000" points="829,1033.7109,819,1037.7109,829,1041.7109,825,1037.7109" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="823" x2="1536.5" y1="1037.7109" y2="1037.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="835" y="1032.645">process FacadeRedirectResult</text><polygon fill="#008000" points="1369,1062.8438,1379,1066.8438,1369,1070.8438,1373,1066.8438" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="818" x2="1375" y1="1066.8438" y2="1066.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="825" y="1061.7778">translate FacadeRedirectResult</text><polygon fill="#008000" points="829,1091.9766,819,1095.9766,829,1099.9766,825,1095.9766" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="823" x2="1385" y1="1095.9766" y2="1095.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="539" x="835" y="1090.9106">This is 303 code with redirection to Embedded authorization dynamic form continuation</text><polygon fill="#008000" points="486,1121.1094,476,1125.1094,486,1129.1094,482,1125.1094" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="480" x2="807" y1="1125.1094" y2="1125.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="492" y="1120.0435">303 Embedded authorization</text><polygon fill="#008000" points="62,1150.2422,52,1154.2422,62,1158.2422,58,1154.2422" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="56" x2="464" y1="1154.2422" y2="1154.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="68" y="1149.1763">303 Embedded authorization</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="3570" y1="1163.2422" y2="1163.2422"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="233" x="28" y="1173.4526">[User supplied all necessary parameters]</text><line style="stroke: #008000; stroke-width: 1.0;" x1="3192.5" x2="3239.5" y1="1193.1797" y2="1193.1797"/><line style="stroke: #008000; stroke-width: 1.0;" x1="3239.5" x2="3239.5" y1="1193.1797" y2="1206.1797"/><line style="stroke: #008000; stroke-width: 1.0;" x1="3198.5" x2="3239.5" y1="1206.1797" y2="1206.1797"/><polygon fill="#008000" points="3208.5,1202.1797,3198.5,1206.1797,3208.5,1210.1797,3204.5,1206.1797" style="stroke: #008000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="3204.5" y="1188.1138">User input OK</text><line style="stroke: #008000; stroke-width: 1.0;" x1="3197.5" x2="3239.5" y1="1254.3125" y2="1254.3125"/><line style="stroke: #008000; stroke-width: 1.0;" x1="3239.5" x2="3239.5" y1="1254.3125" y2="1267.3125"/><line style="stroke: #008000; stroke-width: 1.0;" x1="3198.5" x2="3239.5" y1="1267.3125" y2="1267.3125"/><polygon fill="#008000" points="3208.5,1263.3125,3198.5,1267.3125,3208.5,1271.3125,3204.5,1267.3125" style="stroke: #008000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="3204.5" y="1249.2466">Switch to real execution mode</text><polygon fill="#008000" points="3577.5,1292.4453,3587.5,1296.4453,3577.5,1300.4453,3581.5,1296.4453" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="3197.5" x2="3583.5" y1="1296.4453" y2="1296.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="3204.5" y="1291.3794">Initiate consent</text><polygon fill="#008000" points="3208.5,1321.5781,3198.5,1325.5781,3208.5,1329.5781,3204.5,1325.5781" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="3202.5" x2="3593.5" y1="1325.5781" y2="1325.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="3214.5" y="1320.5122">Redirect authorization required</text><polygon fill="#008000" points="2476,1350.7109,2466,1354.7109,2476,1358.7109,2472,1354.7109" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="2470" x2="3186.5" y1="1354.7109" y2="1354.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="2482" y="1349.645">Redirect to ASPSP required</text><polygon fill="#008000" points="3479.5,1409.8438,3489.5,1413.8438,3479.5,1417.8438,3483.5,1413.8438" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="2465" x2="3485.5" y1="1413.8438" y2="1413.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="2472" y="1408.7778">Translate 'Redirect to ASPSP required'</text><polygon fill="#008000" points="2476,1438.9766,2466,1442.9766,2476,1446.9766,2472,1442.9766" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="2470" x2="3495.5" y1="1442.9766" y2="1442.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="262" x="2482" y="1437.9106">ContextBasedAuthorizationRequiredResult</text><polygon fill="#008000" points="1558.5,1468.1094,1548.5,1472.1094,1558.5,1476.1094,1554.5,1472.1094" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1552.5" x2="2459" y1="1472.1094" y2="1472.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="262" x="1564.5" y="1467.0435">ContextBasedAuthorizationRequiredResult</text><polygon fill="#008000" points="2254.5,1497.2422,2264.5,1501.2422,2254.5,1505.2422,2258.5,1501.2422" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1547.5" x2="2260.5" y1="1501.2422" y2="1501.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="328" x="1554.5" y="1496.1763">Translate RedirectionResult -&gt; FacadeRedirectResult</text><polygon fill="#008000" points="1558.5,1526.375,1548.5,1530.375,1558.5,1534.375,1554.5,1530.375" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1552.5" x2="2270.5" y1="1530.375" y2="1530.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="1564.5" y="1525.3091">FacadeRedirectResult</text><polygon fill="#008000" points="829,1555.5078,819,1559.5078,829,1563.5078,825,1559.5078" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="823" x2="1541.5" y1="1559.5078" y2="1559.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="835" y="1554.4419">FacadeRedirectResult</text><polygon fill="#008000" points="1369,1584.6406,1379,1588.6406,1369,1592.6406,1373,1588.6406" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="818" x2="1375" y1="1588.6406" y2="1588.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="825" y="1583.5747">translate FacadeRedirectResult</text><polygon fill="#008000" points="829,1613.7734,819,1617.7734,829,1621.7734,825,1617.7734" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="823" x2="1385" y1="1617.7734" y2="1617.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="376" x="835" y="1612.7075">This is 303 code with redirection to ASPSP authorization page</text><polygon fill="#008000" points="486,1642.9063,476,1646.9063,486,1650.9063,482,1646.9063" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="480" x2="802" y1="1646.9063" y2="1646.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="492" y="1641.8403">303 Redirect to ASPSP</text><polygon fill="#008000" points="62,1672.0391,52,1676.0391,62,1680.0391,58,1676.0391" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="56" x2="469" y1="1676.0391" y2="1676.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="68" y="1670.9731">303 ASPSP 'Login page'</text><rect fill="#DDDDDD" height="26.2969" rx="5" ry="5" style="stroke: #000000; stroke-width: 1.0;" width="287" x="11" y="11"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="275" x="17" y="28.9951">Embedded initial authorization phase</text><!--MD5=[e20264e68ea5a58be2e978281e5ea4f5]
@startuml
legend top left
  <b>Embedded initial authorization phase</b>
endlegend

actor User

collections TppBackend

box "TPP API"
control TppBankingApiAisController
control ConsentServiceController
participant FacadeResponseMapper
endbox

box "OPBA-Facade"
collections FacadeService
database Database
participant ServiceContextProvider
participant ProtocolSelector
participant Spring
participant ProtocolResultHandler
endbox

box "XS2A-Protocol"
participant Xs2aListAccountsEntrypoint
participant Xs2aUpdateAuthorization
participant Xs2aFromAspspRedirect
participant Xs2aResultBodyExtractor
collections Xs2aServices
participant OutcomeMapper
endbox

boundary ASPSP

== User authorizes this request (embedded to provide i.e. PSU id) ==
loop Until user input has not enough parameters
User [#green]-> TppBackend ++ : POST /consent/embedded\n(Update context with 'Consent valid until', which accounts, etc.)
TppBackend [#green]-> ConsentServiceController ++ : embeddedUsingPOST
ConsentServiceController [#green]-> FacadeService ++ : Facade.execute()
FacadeService [#green]-> ServiceContextProvider ++ : Create facade context from request
FacadeService <-[#green] ServiceContextProvider - - : ServiceContext
FacadeService [#green]-> ProtocolSelector ++: Select bank protocol by using authorization session id
ProtocolSelector [#green]-> Database ++ : Read authorization session using authId from request
Database [#green]-> ProtocolSelector - - : AuthorizationSession
ProtocolSelector [#green]-> Database ++ : Read bank protocol using AuthorizationSession.bankProtocolId
Database [#green]-> ProtocolSelector - - : BankProtocol
ProtocolSelector [#green]-> FacadeService - - : BankProtocol
FacadeService [#green]-> Spring ++ : Find bean - Bean(BankProtocol.protocolBeanName) extends Action
FacadeService <-[#green] Spring - - : It is Xs2aUpdateAuthorization service bean
FacadeService [#green]-> Xs2aListAccountsEntrypoint ++ : Xs2aListAccountsEntrypoint.execute(ServiceContext)
Xs2aListAccountsEntrypoint [#green]-> Xs2aServices ++
Xs2aServices [#green]-> Database ++ : Consent for service session
Xs2aServices <-[#green] Database - - : No consent
alt User supplied not enough data
  Xs2aServices [#green]-> Xs2aServices : Validate API input -\ndo we have enough data (Mocked execution)
  Xs2aServices [#green]-> Xs2aListAccountsEntrypoint - - : ValidationIssue[] -> User input has missing parameters
  Xs2aListAccountsEntrypoint [#green]-> OutcomeMapper ++ : Translate ValidationIssue[]
  OutcomeMapper [#green]-> Xs2aListAccountsEntrypoint - - : ContextBasedValidationErrorResult
  Xs2aListAccountsEntrypoint [#green]-> FacadeService - - : ContextBasedValidationErrorResult
  FacadeService [#green]-> ProtocolResultHandler ++ : Translate ContextBasedValidationErrorResult -> FacadeStartAuthorizationResult
  ProtocolResultHandler [#green]-> Database ++ : Authorization session present?
  Database [#green]-> ProtocolResultHandler - - : AuthorizationSession
  ProtocolResultHandler [#green]-> FacadeService - - : FacadeRedirectResult
  FacadeService [#green]-> ConsentServiceController ++ : process FacadeRedirectResult
  ConsentServiceController [#green]-> FacadeResponseMapper ++ : translate FacadeRedirectResult
  FacadeResponseMapper [#green]-> ConsentServiceController - - : This is 303 code with redirection to Embedded authorization dynamic form continuation
  ConsentServiceController [#green]-> TppBackend  : 303 Embedded authorization
  TppBackend [#green]-> User : 303 Embedded authorization
else User supplied all necessary parameters
  Xs2aServices [#green]-> Xs2aServices ++ : User input OK
end
end

Xs2aServices [#green]-> Xs2aServices : Switch to real execution mode
Xs2aServices [#green]-> ASPSP ++ : Initiate consent
ASPSP [#green]-> Xs2aServices - - : Redirect authorization required
Xs2aServices [#green]-> Xs2aListAccountsEntrypoint ++ : Redirect to ASPSP required
deactivate Xs2aServices
Xs2aListAccountsEntrypoint [#green]-> OutcomeMapper ++ : Translate 'Redirect to ASPSP required'
OutcomeMapper [#green]-> Xs2aListAccountsEntrypoint - - : ContextBasedAuthorizationRequiredResult
Xs2aListAccountsEntrypoint [#green]-> FacadeService - - : ContextBasedAuthorizationRequiredResult
FacadeService [#green]-> ProtocolResultHandler ++ : Translate RedirectionResult -> FacadeRedirectResult
ProtocolResultHandler [#green]-> FacadeService - - : FacadeRedirectResult
FacadeService [#green]-> ConsentServiceController - - : FacadeRedirectResult
ConsentServiceController [#green]-> FacadeResponseMapper ++ : translate FacadeRedirectResult
FacadeResponseMapper [#green]-> ConsentServiceController - - : This is 303 code with redirection to ASPSP authorization page
ConsentServiceController [#green]-> TppBackend - - : 303 Redirect to ASPSP
TppBackend [#green]-> User - - : 303 ASPSP 'Login page'
@enduml

PlantUML version 1.2019.11(Sun Sep 22 13:02:15 EEST 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.5+10-b520.30
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>