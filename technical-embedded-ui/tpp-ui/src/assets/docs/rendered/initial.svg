<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1163px" preserveAspectRatio="none" style="width:3056px;height:1163px;" version="1.1" viewBox="0 0 3056 1163" width="3056px" zoomAndPan="magnify"><defs><filter height="300%" id="f1cybyridcoq1q" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="1088.5781" style="stroke: #A80036; stroke-width: 1.0;" width="607" x="370" y="63.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="57" x="645" y="75.6606">TPP API</text><rect fill="#DDDDDD" height="1088.5781" style="stroke: #A80036; stroke-width: 1.0;" width="807" x="979" y="63.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="100" x="1332.5" y="75.6606">OPBA-Facade</text><rect fill="#DDDDDD" height="1088.5781" style="stroke: #A80036; stroke-width: 1.0;" width="1255" x="1788" y="63.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="104" x="2363.5" y="75.6606">XS2A-Protocol</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="38" x2="38" y1="145.8906" y2="1065.875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="263.5" x2="263.5" y1="145.8906" y2="1065.875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="472" x2="472" y1="145.8906" y2="1065.875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="672" x2="672" y1="145.8906" y2="1065.875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="877" x2="877" y1="145.8906" y2="1065.875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1044" x2="1044" y1="145.8906" y2="1065.875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1151" x2="1151" y1="145.8906" y2="1065.875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1297" x2="1297" y1="145.8906" y2="1065.875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1462" x2="1462" y1="145.8906" y2="1065.875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1569" x2="1569" y1="145.8906" y2="1065.875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1696" x2="1696" y1="145.8906" y2="1065.875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1897" x2="1897" y1="145.8906" y2="1065.875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2108" x2="2108" y1="145.8906" y2="1065.875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2309" x2="2309" y1="145.8906" y2="1065.875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2509" x2="2509" y1="145.8906" y2="1065.875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2672" x2="2672" y1="145.8906" y2="1065.875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2972" x2="2972" y1="145.8906" y2="1065.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="8" y="142.5889">FinTech</text><ellipse cx="38.5" cy="72.5938" fill="#FEFECE" filter="url(#f1cybyridcoq1q)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M38.5,80.5938 L38.5,107.5938 M25.5,88.5938 L51.5,88.5938 M38.5,107.5938 L25.5,122.5938 M38.5,107.5938 L51.5,122.5938 " fill="none" filter="url(#f1cybyridcoq1q)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="8" y="1077.8701">FinTech</text><ellipse cx="38.5" cy="1091.1719" fill="#FEFECE" filter="url(#f1cybyridcoq1q)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M38.5,1099.1719 L38.5,1126.1719 M25.5,1107.1719 L51.5,1107.1719 M38.5,1126.1719 L25.5,1141.1719 M38.5,1126.1719 L51.5,1141.1719 " fill="none" filter="url(#f1cybyridcoq1q)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="212.5" y="106.5938"/><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="208.5" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="215.5" y="130.5889">TppBackend</text><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="212.5" y="1064.875"/><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="208.5" y="1068.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="215.5" y="1088.8701">TppBackend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="191" x="374" y="142.5889">TppBankingApiAisController</text><ellipse cx="472.5" cy="113.5938" fill="#FEFECE" filter="url(#f1cybyridcoq1q)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="468.5,101.5938,474.5,96.5938,472.5,101.5938,474.5,106.5938,468.5,101.5938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="191" x="374" y="1077.8701">TppBankingApiAisController</text><ellipse cx="472.5" cy="1097.1719" fill="#FEFECE" filter="url(#f1cybyridcoq1q)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="468.5,1085.1719,474.5,1080.1719,472.5,1085.1719,474.5,1090.1719,468.5,1085.1719" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="176" x="581" y="142.5889">ConsentServiceController</text><ellipse cx="672" cy="113.5938" fill="#FEFECE" filter="url(#f1cybyridcoq1q)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="668,101.5938,674,96.5938,672,101.5938,674,106.5938,668,101.5938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="176" x="581" y="1077.8701">ConsentServiceController</text><ellipse cx="672" cy="1097.1719" fill="#FEFECE" filter="url(#f1cybyridcoq1q)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="668,1085.1719,674,1080.1719,672,1085.1719,674,1090.1719,668,1085.1719" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="187" x="782" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="173" x="789" y="130.5889">FacadeResponseMapper</text><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="187" x="782" y="1064.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="173" x="789" y="1084.8701">FacadeResponseMapper</text><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="987" y="106.5938"/><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="983" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="990" y="130.5889">FacadeService</text><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="987" y="1064.875"/><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="983" y="1068.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="990" y="1088.8701">FacadeService</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="1115" y="142.5889">Database</text><path d="M1133,93.5938 C1133,83.5938 1151,83.5938 1151,83.5938 C1151,83.5938 1169,83.5938 1169,93.5938 L1169,119.5938 C1169,129.5938 1151,129.5938 1151,129.5938 C1151,129.5938 1133,129.5938 1133,119.5938 L1133,93.5938 " fill="#FEFECE" filter="url(#f1cybyridcoq1q)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1133,93.5938 C1133,103.5938 1151,103.5938 1151,103.5938 C1151,103.5938 1169,103.5938 1169,93.5938 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="1115" y="1077.8701">Database</text><path d="M1133,1091.1719 C1133,1081.1719 1151,1081.1719 1151,1081.1719 C1151,1081.1719 1169,1081.1719 1169,1091.1719 L1169,1117.1719 C1169,1127.1719 1151,1127.1719 1151,1127.1719 C1151,1127.1719 1133,1127.1719 1133,1117.1719 L1133,1091.1719 " fill="#FEFECE" filter="url(#f1cybyridcoq1q)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1133,1091.1719 C1133,1101.1719 1151,1101.1719 1151,1101.1719 C1151,1101.1719 1169,1101.1719 1169,1091.1719 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="1208" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="160" x="1215" y="130.5889">ServiceContextProvider</text><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="1208" y="1064.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="160" x="1215" y="1084.8701">ServiceContextProvider</text><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="128" x="1396" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="1403" y="130.5889">ProtocolSelector</text><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="128" x="1396" y="1064.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="1403" y="1084.8701">ProtocolSelector</text><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="1538" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="1545" y="130.5889">Spring</text><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="1538" y="1064.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="1545" y="1084.8701">Spring</text><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="168" x="1610" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1617" y="130.5889">ProtocolResultHandler</text><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="168" x="1610" y="1064.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1617" y="1084.8701">ProtocolResultHandler</text><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="206" x="1792" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="192" x="1799" y="130.5889">Xs2aListAccountsEntrypoint</text><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="206" x="1792" y="1064.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="192" x="1799" y="1084.8701">Xs2aListAccountsEntrypoint</text><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="189" x="2012" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="175" x="2019" y="130.5889">Xs2aUpdateAuthorization</text><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="189" x="2012" y="1064.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="175" x="2019" y="1084.8701">Xs2aUpdateAuthorization</text><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="184" x="2215" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="170" x="2222" y="130.5889">Xs2aFromAspspRedirect</text><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="184" x="2215" y="1064.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="170" x="2222" y="1084.8701">Xs2aFromAspspRedirect</text><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="188" x="2413" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="174" x="2420" y="130.5889">Xs2aResultBodyExtractor</text><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="188" x="2413" y="1064.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="174" x="2420" y="1084.8701">Xs2aResultBodyExtractor</text><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="2619" y="106.5938"/><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="2615" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="2622" y="130.5889">Xs2aServices</text><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="2619" y="1064.875"/><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="2615" y="1068.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="2622" y="1088.8701">Xs2aServices</text><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="2905" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="2912" y="130.5889">OutcomeMapper</text><rect fill="#FEFECE" filter="url(#f1cybyridcoq1q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="2905" y="1064.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="2912" y="1084.8701">OutcomeMapper</text><rect fill="#EEEEEE" filter="url(#f1cybyridcoq1q)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3041" x="3" y="176.457"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3044" y1="176.457" y2="176.457"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3044" y1="179.457" y2="179.457"/><rect fill="#EEEEEE" filter="url(#f1cybyridcoq1q)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="267" x="1390" y="165.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="248" x="1396" y="181.9575">FinTech asks for user account list</text><polygon fill="#0000FF" points="251.5,231.2891,261.5,235.2891,251.5,239.2891,255.5,235.2891" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="38.5" x2="257.5" y1="235.2891" y2="235.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="45.5" y="215.0903">GET /accounts</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="45.5" y="230.2231">(Fintech user info, bank id, etc.)</text><polygon fill="#0000FF" points="460.5,260.4219,470.5,264.4219,460.5,268.4219,464.5,264.4219" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="263.5" x2="466.5" y1="264.4219" y2="264.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="270.5" y="259.356">getAccounts</text><polygon fill="#0000FF" points="1032,289.5547,1042,293.5547,1032,297.5547,1036,293.5547" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="472.5" x2="1038" y1="293.5547" y2="293.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="479.5" y="288.4888">Facade.execute()</text><polygon fill="#0000FF" points="1285,318.6875,1295,322.6875,1285,326.6875,1289,322.6875" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1044" x2="1291" y1="322.6875" y2="322.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="1051" y="317.6216">Create facade context from request</text><polygon fill="#0000FF" points="1055,347.8203,1045,351.8203,1055,355.8203,1051,351.8203" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1049" x2="1296" y1="351.8203" y2="351.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="1061" y="346.7544">ServiceContext</text><polygon fill="#0000FF" points="1450,376.9531,1460,380.9531,1450,384.9531,1454,380.9531" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1044" x2="1456" y1="380.9531" y2="380.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="328" x="1051" y="375.8872">Select bank protocol from request type and bank id</text><polygon fill="#0000FF" points="1055,406.0859,1045,410.0859,1055,414.0859,1051,410.0859" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1049" x2="1461" y1="410.0859" y2="410.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="1061" y="405.02">BankProtocol</text><polygon fill="#0000FF" points="1557,435.2188,1567,439.2188,1557,443.2188,1561,439.2188" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1044" x2="1563" y1="439.2188" y2="439.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="429" x="1051" y="434.1528">Find bean - Bean(BankProtocol.protocolBeanName) extends Action</text><polygon fill="#0000FF" points="1055,464.3516,1045,468.3516,1055,472.3516,1051,468.3516" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1049" x2="1568" y1="468.3516" y2="468.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="1061" y="463.2856">It is Xs2aListAccountsEntrypoint service bean</text><polygon fill="#0000FF" points="1885,493.4844,1895,497.4844,1885,501.4844,1889,497.4844" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1044" x2="1891" y1="497.4844" y2="497.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="339" x="1051" y="492.4185">Xs2aListAccountsEntrypoint.execute(ServiceContext)</text><polygon fill="#0000FF" points="2660,507.4844,2670,511.4844,2660,515.4844,2664,511.4844" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1897" x2="2666" y1="511.4844" y2="511.4844"/><polygon fill="#0000FF" points="1162,536.6172,1152,540.6172,1162,544.6172,1158,540.6172" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1156" x2="2671" y1="540.6172" y2="540.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="1168" y="535.5513">Consent for service session</text><polygon fill="#0000FF" points="2660,565.75,2670,569.75,2660,573.75,2664,569.75" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1151" x2="2666" y1="569.75" y2="569.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="1158" y="564.6841">No consent</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="2672" x2="2714" y1="614.0156" y2="614.0156"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="2714" x2="2714" y1="614.0156" y2="627.0156"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="2673" x2="2714" y1="627.0156" y2="627.0156"/><polygon fill="#0000FF" points="2683,623.0156,2673,627.0156,2683,631.0156,2679,627.0156" style="stroke: #0000FF; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="2679" y="593.8169">Validate API input -</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="2679" y="608.9497">do we have enough data (Mocked execution)</text><polygon fill="#0000FF" points="1908,652.1484,1898,656.1484,1908,660.1484,1904,656.1484" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1902" x2="2671" y1="656.1484" y2="656.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="355" x="1914" y="651.0825">ValidationIssue[] -&gt; User input has missing parameters</text><polygon fill="#0000FF" points="2960,681.2813,2970,685.2813,2960,689.2813,2964,685.2813" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1897" x2="2966" y1="685.2813" y2="685.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="1904" y="680.2153">Translate ValidationIssue[]</text><polygon fill="#0000FF" points="1908,710.4141,1898,714.4141,1908,718.4141,1904,714.4141" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1902" x2="2971" y1="714.4141" y2="714.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="1914" y="709.3481">ContextBasedValidationErrorResult</text><polygon fill="#0000FF" points="1055,739.5469,1045,743.5469,1055,747.5469,1051,743.5469" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1049" x2="1896" y1="743.5469" y2="743.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="1061" y="738.481">ContextBasedValidationErrorResult</text><polygon fill="#0000FF" points="1684,768.6797,1694,772.6797,1684,776.6797,1688,772.6797" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1044" x2="1690" y1="772.6797" y2="772.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="512" x="1051" y="767.6138">Translate ContextBasedValidationErrorResult -&gt; FacadeStartAuthorizationResult</text><polygon fill="#0000FF" points="1162,797.8125,1152,801.8125,1162,805.8125,1158,801.8125" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1156" x2="1695" y1="801.8125" y2="801.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="1168" y="796.7466">Authorization session present?</text><polygon fill="#0000FF" points="1684,826.9453,1694,830.9453,1684,834.9453,1688,830.9453" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1151" x2="1690" y1="830.9453" y2="830.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1158" y="825.8794">No authorization session</text><polygon fill="#0000FF" points="1162,856.0781,1152,860.0781,1162,864.0781,1158,860.0781" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1156" x2="1695" y1="860.0781" y2="860.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="1168" y="855.0122">Create authorization session</text><polygon fill="#0000FF" points="483.5,885.2109,473.5,889.2109,483.5,893.2109,479.5,889.2109" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="477.5" x2="1695" y1="889.2109" y2="889.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="489.5" y="884.145">process FacadeStartAuthorizationResult</text><polygon fill="#0000FF" points="865.5,914.3438,875.5,918.3438,865.5,922.3438,869.5,918.3438" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="472.5" x2="871.5" y1="918.3438" y2="918.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="263" x="479.5" y="913.2778">translate FacadeStartAuthorizationResult</text><polygon fill="#0000FF" points="483.5,943.4766,473.5,947.4766,483.5,951.4766,479.5,947.4766" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="477.5" x2="876.5" y1="947.4766" y2="947.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="381" x="489.5" y="942.4106">This is 202 code with redirection to Embedded authorization</text><polygon fill="#0000FF" points="274.5,972.6094,264.5,976.6094,274.5,980.6094,270.5,976.6094" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="268.5" x2="471.5" y1="976.6094" y2="976.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="280.5" y="971.5435">202 Embedded authorization</text><polygon fill="#0000FF" points="49.5,1001.7422,39.5,1005.7422,49.5,1009.7422,45.5,1005.7422" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="43.5" x2="262.5" y1="1005.7422" y2="1005.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="55.5" y="1000.6763">202 Embedded authorization</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="38.5" x2="80.5" y1="1034.875" y2="1034.875"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="80.5" x2="80.5" y1="1034.875" y2="1047.875"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="39.5" x2="80.5" y1="1047.875" y2="1047.875"/><polygon fill="#0000FF" points="49.5,1043.875,39.5,1047.875,49.5,1051.875,45.5,1047.875" style="stroke: #0000FF; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="45.5" y="1029.8091">Store</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="131" x="84.5" y="1029.8091">service session id</text><rect fill="#DDDDDD" height="42.5938" rx="5" ry="5" style="stroke: #000000; stroke-width: 1.0;" width="398" x="11" y="11"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="17" y="28.9951">Initial request</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="386" x="17" y="45.292">TppBackend that enters embedded authorization mode</text><!--MD5=[af5b133dd73c146bf7868bad3e95c5e7]
@startuml
legend top left
  <b>Initial request</b>
  TppBackend that enters embedded authorization mode
endlegend

actor FinTech

collections TppBackend

box "TPP API"
control TppBankingApiAisController
control ConsentServiceController
participant FacadeResponseMapper
endbox

box "OPBA-Facade"
collections FacadeService
database Database
participant ServiceContextProvider
participant ProtocolSelector
participant Spring
participant ProtocolResultHandler
endbox

box "XS2A-Protocol"
participant Xs2aListAccountsEntrypoint
participant Xs2aUpdateAuthorization
participant Xs2aFromAspspRedirect
participant Xs2aResultBodyExtractor
collections Xs2aServices
participant OutcomeMapper
endbox

== FinTech asks for user account list ==
FinTech [#blue]-> TppBackend : GET /accounts\n(Fintech user info, bank id, etc.)
TppBackend [#blue]-> TppBankingApiAisController : getAccounts
TppBankingApiAisController [#blue]-> FacadeService : Facade.execute()
FacadeService [#blue]-> ServiceContextProvider : Create facade context from request
FacadeService <-[#blue] ServiceContextProvider : ServiceContext
FacadeService [#blue]-> ProtocolSelector : Select bank protocol from request type and bank id
ProtocolSelector [#blue]-> FacadeService : BankProtocol
FacadeService [#blue]-> Spring : Find bean - Bean(BankProtocol.protocolBeanName) extends Action
FacadeService <-[#blue] Spring : It is Xs2aListAccountsEntrypoint service bean
FacadeService [#blue]-> Xs2aListAccountsEntrypoint : Xs2aListAccountsEntrypoint.execute(ServiceContext)
Xs2aListAccountsEntrypoint [#blue]-> Xs2aServices
Xs2aServices [#blue]-> Database : Consent for service session
Xs2aServices <-[#blue] Database : No consent
Xs2aServices [#blue]-> Xs2aServices : Validate API input -\ndo we have enough data (Mocked execution)
Xs2aServices [#blue]-> Xs2aListAccountsEntrypoint : ValidationIssue[] -> User input has missing parameters
Xs2aListAccountsEntrypoint [#blue]-> OutcomeMapper : Translate ValidationIssue[]
OutcomeMapper [#blue]-> Xs2aListAccountsEntrypoint : ContextBasedValidationErrorResult
Xs2aListAccountsEntrypoint [#blue]-> FacadeService : ContextBasedValidationErrorResult
FacadeService [#blue]-> ProtocolResultHandler : Translate ContextBasedValidationErrorResult -> FacadeStartAuthorizationResult
ProtocolResultHandler [#blue]-> Database : Authorization session present?
Database [#blue]-> ProtocolResultHandler : No authorization session
ProtocolResultHandler [#blue]-> Database : Create authorization session
ProtocolResultHandler [#blue]-> TppBankingApiAisController : process FacadeStartAuthorizationResult
TppBankingApiAisController [#blue]-> FacadeResponseMapper : translate FacadeStartAuthorizationResult
FacadeResponseMapper [#blue]-> TppBankingApiAisController : This is 202 code with redirection to Embedded authorization
TppBankingApiAisController [#blue]-> TppBackend : 202 Embedded authorization
TppBackend [#blue]-> FinTech : 202 Embedded authorization
FinTech [#blue]-> FinTech : Store <b>service session id</b>
@enduml

PlantUML version 1.2019.11(Sun Sep 22 13:02:15 EEST 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_232-release-1638-b6
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>
