<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1221px" preserveAspectRatio="none" style="width:3082px;height:1221px;" version="1.1" viewBox="0 0 3082 1221" width="3082px" zoomAndPan="magnify"><defs><filter height="300%" id="f14xfpt5vi6myt" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="1146.8438" style="stroke: #A80036; stroke-width: 1.0;" width="607" x="370" y="63.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="57" x="645" y="75.6606">TPP API</text><rect fill="#DDDDDD" height="1146.8438" style="stroke: #A80036; stroke-width: 1.0;" width="833" x="979" y="63.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="100" x="1345.5" y="75.6606">OPBA-Facade</text><rect fill="#DDDDDD" height="1146.8438" style="stroke: #A80036; stroke-width: 1.0;" width="1255" x="1814" y="63.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="104" x="2389.5" y="75.6606">XS2A-Protocol</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="38" x2="38" y1="145.8906" y2="1124.1406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="263.5" x2="263.5" y1="145.8906" y2="1124.1406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="472" x2="472" y1="145.8906" y2="1124.1406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="672" x2="672" y1="145.8906" y2="1124.1406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="877" x2="877" y1="145.8906" y2="1124.1406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1044" x2="1044" y1="145.8906" y2="1124.1406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1151" x2="1151" y1="145.8906" y2="1124.1406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1297" x2="1297" y1="145.8906" y2="1124.1406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1488" x2="1488" y1="145.8906" y2="1124.1406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1595" x2="1595" y1="145.8906" y2="1124.1406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1722" x2="1722" y1="145.8906" y2="1124.1406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1923" x2="1923" y1="145.8906" y2="1124.1406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2134" x2="2134" y1="145.8906" y2="1124.1406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2335" x2="2335" y1="145.8906" y2="1124.1406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2535" x2="2535" y1="145.8906" y2="1124.1406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2698" x2="2698" y1="145.8906" y2="1124.1406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2998" x2="2998" y1="145.8906" y2="1124.1406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="8" y="142.5889">FinTech</text><ellipse cx="38.5" cy="72.5938" fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M38.5,80.5938 L38.5,107.5938 M25.5,88.5938 L51.5,88.5938 M38.5,107.5938 L25.5,122.5938 M38.5,107.5938 L51.5,122.5938 " fill="none" filter="url(#f14xfpt5vi6myt)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="8" y="1136.1357">FinTech</text><ellipse cx="38.5" cy="1149.4375" fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M38.5,1157.4375 L38.5,1184.4375 M25.5,1165.4375 L51.5,1165.4375 M38.5,1184.4375 L25.5,1199.4375 M38.5,1184.4375 L51.5,1199.4375 " fill="none" filter="url(#f14xfpt5vi6myt)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="212.5" y="106.5938"/><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="208.5" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="215.5" y="130.5889">TppBackend</text><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="212.5" y="1123.1406"/><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="208.5" y="1127.1406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="215.5" y="1147.1357">TppBackend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="191" x="374" y="142.5889">TppBankingApiAisController</text><ellipse cx="472.5" cy="113.5938" fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="468.5,101.5938,474.5,96.5938,472.5,101.5938,474.5,106.5938,468.5,101.5938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="191" x="374" y="1136.1357">TppBankingApiAisController</text><ellipse cx="472.5" cy="1155.4375" fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="468.5,1143.4375,474.5,1138.4375,472.5,1143.4375,474.5,1148.4375,468.5,1143.4375" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="176" x="581" y="142.5889">ConsentServiceController</text><ellipse cx="672" cy="113.5938" fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="668,101.5938,674,96.5938,672,101.5938,674,106.5938,668,101.5938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="176" x="581" y="1136.1357">ConsentServiceController</text><ellipse cx="672" cy="1155.4375" fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="668,1143.4375,674,1138.4375,672,1143.4375,674,1148.4375,668,1143.4375" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="187" x="782" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="173" x="789" y="130.5889">FacadeResponseMapper</text><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="187" x="782" y="1123.1406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="173" x="789" y="1143.1357">FacadeResponseMapper</text><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="987" y="106.5938"/><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="983" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="990" y="130.5889">FacadeService</text><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="987" y="1123.1406"/><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="983" y="1127.1406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="990" y="1147.1357">FacadeService</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="1115" y="142.5889">Database</text><path d="M1133,93.5938 C1133,83.5938 1151,83.5938 1151,83.5938 C1151,83.5938 1169,83.5938 1169,93.5938 L1169,119.5938 C1169,129.5938 1151,129.5938 1151,129.5938 C1151,129.5938 1133,129.5938 1133,119.5938 L1133,93.5938 " fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1133,93.5938 C1133,103.5938 1151,103.5938 1151,103.5938 C1151,103.5938 1169,103.5938 1169,93.5938 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="1115" y="1136.1357">Database</text><path d="M1133,1149.4375 C1133,1139.4375 1151,1139.4375 1151,1139.4375 C1151,1139.4375 1169,1139.4375 1169,1149.4375 L1169,1175.4375 C1169,1185.4375 1151,1185.4375 1151,1185.4375 C1151,1185.4375 1133,1185.4375 1133,1175.4375 L1133,1149.4375 " fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1133,1149.4375 C1133,1159.4375 1151,1159.4375 1151,1159.4375 C1151,1159.4375 1169,1159.4375 1169,1149.4375 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="1208" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="160" x="1215" y="130.5889">ServiceContextProvider</text><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="1208" y="1123.1406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="160" x="1215" y="1143.1357">ServiceContextProvider</text><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="128" x="1422" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="1429" y="130.5889">ProtocolSelector</text><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="128" x="1422" y="1123.1406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="1429" y="1143.1357">ProtocolSelector</text><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="1564" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="1571" y="130.5889">Spring</text><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="1564" y="1123.1406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="1571" y="1143.1357">Spring</text><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="168" x="1636" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1643" y="130.5889">ProtocolResultHandler</text><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="168" x="1636" y="1123.1406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1643" y="1143.1357">ProtocolResultHandler</text><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="206" x="1818" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="192" x="1825" y="130.5889">Xs2aListAccountsEntrypoint</text><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="206" x="1818" y="1123.1406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="192" x="1825" y="1143.1357">Xs2aListAccountsEntrypoint</text><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="189" x="2038" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="175" x="2045" y="130.5889">Xs2aUpdateAuthorization</text><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="189" x="2038" y="1123.1406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="175" x="2045" y="1143.1357">Xs2aUpdateAuthorization</text><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="184" x="2241" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="170" x="2248" y="130.5889">Xs2aFromAspspRedirect</text><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="184" x="2241" y="1123.1406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="170" x="2248" y="1143.1357">Xs2aFromAspspRedirect</text><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="188" x="2439" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="174" x="2446" y="130.5889">Xs2aResultBodyExtractor</text><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="188" x="2439" y="1123.1406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="174" x="2446" y="1143.1357">Xs2aResultBodyExtractor</text><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="2645" y="106.5938"/><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="2641" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="2648" y="130.5889">Xs2aServices</text><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="2645" y="1123.1406"/><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="2641" y="1127.1406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="2648" y="1147.1357">Xs2aServices</text><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="2931" y="110.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="2938" y="130.5889">OutcomeMapper</text><rect fill="#FEFECE" filter="url(#f14xfpt5vi6myt)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="2931" y="1123.1406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="2938" y="1143.1357">OutcomeMapper</text><rect fill="#EEEEEE" filter="url(#f14xfpt5vi6myt)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3067" x="3" y="176.457"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3070" y1="176.457" y2="176.457"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3070" y1="179.457" y2="179.457"/><rect fill="#EEEEEE" filter="url(#f14xfpt5vi6myt)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="267" x="1403" y="165.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="248" x="1409" y="181.9575">FinTech asks for user account list</text><polygon fill="#0000FF" points="251.5,231.2891,261.5,235.2891,251.5,239.2891,255.5,235.2891" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="38.5" x2="257.5" y1="235.2891" y2="235.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="45.5" y="215.0903">GET /accounts</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="45.5" y="230.2231">(Fintech user info, bank id, etc.)</text><polygon fill="#0000FF" points="460.5,260.4219,470.5,264.4219,460.5,268.4219,464.5,264.4219" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="263.5" x2="466.5" y1="264.4219" y2="264.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="270.5" y="259.356">getAccounts</text><polygon fill="#0000FF" points="1032,289.5547,1042,293.5547,1032,297.5547,1036,293.5547" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="472.5" x2="1038" y1="293.5547" y2="293.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="479.5" y="288.4888">Facade.execute()</text><polygon fill="#0000FF" points="1285,318.6875,1295,322.6875,1285,326.6875,1289,322.6875" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1044" x2="1291" y1="322.6875" y2="322.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="1051" y="317.6216">Create facade context from request</text><polygon fill="#0000FF" points="1055,347.8203,1045,351.8203,1055,355.8203,1051,351.8203" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1049" x2="1296" y1="351.8203" y2="351.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="1061" y="346.7544">ServiceContext</text><polygon fill="#0000FF" points="1476,376.9531,1486,380.9531,1476,384.9531,1480,380.9531" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1044" x2="1482" y1="380.9531" y2="380.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="328" x="1051" y="375.8872">Select bank protocol from request type and bank id</text><polygon fill="#0000FF" points="1162,406.0859,1152,410.0859,1162,414.0859,1158,410.0859" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1156" x2="1487" y1="410.0859" y2="410.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="313" x="1168" y="405.02">Read bank protocol using bank uuid and action id</text><polygon fill="#0000FF" points="1476,435.2188,1486,439.2188,1476,443.2188,1480,439.2188" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1151" x2="1482" y1="439.2188" y2="439.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="1158" y="434.1528">BankProtocol</text><polygon fill="#0000FF" points="1055,464.3516,1045,468.3516,1055,472.3516,1051,468.3516" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1049" x2="1487" y1="468.3516" y2="468.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="1061" y="463.2856">BankProtocol</text><polygon fill="#0000FF" points="1583,493.4844,1593,497.4844,1583,501.4844,1587,497.4844" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1044" x2="1589" y1="497.4844" y2="497.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="429" x="1051" y="492.4185">Find bean - Bean(BankProtocol.protocolBeanName) extends Action</text><polygon fill="#0000FF" points="1055,522.6172,1045,526.6172,1055,530.6172,1051,526.6172" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1049" x2="1594" y1="526.6172" y2="526.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="1061" y="521.5513">It is Xs2aListAccountsEntrypoint service bean</text><polygon fill="#0000FF" points="1911,551.75,1921,555.75,1911,559.75,1915,555.75" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1044" x2="1917" y1="555.75" y2="555.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="339" x="1051" y="550.6841">Xs2aListAccountsEntrypoint.execute(ServiceContext)</text><polygon fill="#0000FF" points="2686,565.75,2696,569.75,2686,573.75,2690,569.75" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1923" x2="2692" y1="569.75" y2="569.75"/><polygon fill="#0000FF" points="1162,594.8828,1152,598.8828,1162,602.8828,1158,598.8828" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1156" x2="2697" y1="598.8828" y2="598.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="1168" y="593.8169">Consent for service session</text><polygon fill="#0000FF" points="2686,624.0156,2696,628.0156,2686,632.0156,2690,628.0156" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1151" x2="2692" y1="628.0156" y2="628.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="1158" y="622.9497">No consent</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="2698" x2="2740" y1="672.2813" y2="672.2813"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="2740" x2="2740" y1="672.2813" y2="685.2813"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="2699" x2="2740" y1="685.2813" y2="685.2813"/><polygon fill="#0000FF" points="2709,681.2813,2699,685.2813,2709,689.2813,2705,685.2813" style="stroke: #0000FF; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="2705" y="652.0825">Validate API input -</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="2705" y="667.2153">do we have enough data (Mocked execution)</text><polygon fill="#0000FF" points="1934,710.4141,1924,714.4141,1934,718.4141,1930,714.4141" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1928" x2="2697" y1="714.4141" y2="714.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="355" x="1940" y="709.3481">ValidationIssue[] -&gt; User input has missing parameters</text><polygon fill="#0000FF" points="2986,739.5469,2996,743.5469,2986,747.5469,2990,743.5469" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1923" x2="2992" y1="743.5469" y2="743.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="1930" y="738.481">Translate ValidationIssue[]</text><polygon fill="#0000FF" points="1934,768.6797,1924,772.6797,1934,776.6797,1930,772.6797" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1928" x2="2997" y1="772.6797" y2="772.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="1940" y="767.6138">ContextBasedValidationErrorResult</text><polygon fill="#0000FF" points="1055,797.8125,1045,801.8125,1055,805.8125,1051,801.8125" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1049" x2="1922" y1="801.8125" y2="801.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="1061" y="796.7466">ContextBasedValidationErrorResult</text><polygon fill="#0000FF" points="1710,826.9453,1720,830.9453,1710,834.9453,1714,830.9453" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1044" x2="1716" y1="830.9453" y2="830.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="512" x="1051" y="825.8794">Translate ContextBasedValidationErrorResult -&gt; FacadeStartAuthorizationResult</text><polygon fill="#0000FF" points="1162,856.0781,1152,860.0781,1162,864.0781,1158,860.0781" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1156" x2="1721" y1="860.0781" y2="860.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="1168" y="855.0122">Authorization session present?</text><polygon fill="#0000FF" points="1710,885.2109,1720,889.2109,1710,893.2109,1714,889.2109" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1151" x2="1716" y1="889.2109" y2="889.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1158" y="884.145">No authorization session</text><polygon fill="#0000FF" points="1162,914.3438,1152,918.3438,1162,922.3438,1158,918.3438" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1156" x2="1721" y1="918.3438" y2="918.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="1168" y="913.2778">Create authorization session</text><polygon fill="#0000FF" points="483.5,943.4766,473.5,947.4766,483.5,951.4766,479.5,947.4766" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="477.5" x2="1721" y1="947.4766" y2="947.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="489.5" y="942.4106">process FacadeStartAuthorizationResult</text><polygon fill="#0000FF" points="865.5,972.6094,875.5,976.6094,865.5,980.6094,869.5,976.6094" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="472.5" x2="871.5" y1="976.6094" y2="976.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="263" x="479.5" y="971.5435">translate FacadeStartAuthorizationResult</text><polygon fill="#0000FF" points="483.5,1001.7422,473.5,1005.7422,483.5,1009.7422,479.5,1005.7422" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="477.5" x2="876.5" y1="1005.7422" y2="1005.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="381" x="489.5" y="1000.6763">This is 202 code with redirection to Embedded authorization</text><polygon fill="#0000FF" points="274.5,1030.875,264.5,1034.875,274.5,1038.875,270.5,1034.875" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="268.5" x2="471.5" y1="1034.875" y2="1034.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="280.5" y="1029.8091">202 Embedded authorization</text><polygon fill="#0000FF" points="49.5,1060.0078,39.5,1064.0078,49.5,1068.0078,45.5,1064.0078" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="43.5" x2="262.5" y1="1064.0078" y2="1064.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="55.5" y="1058.9419">202 Embedded authorization</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="38.5" x2="80.5" y1="1093.1406" y2="1093.1406"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="80.5" x2="80.5" y1="1093.1406" y2="1106.1406"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="39.5" x2="80.5" y1="1106.1406" y2="1106.1406"/><polygon fill="#0000FF" points="49.5,1102.1406,39.5,1106.1406,49.5,1110.1406,45.5,1106.1406" style="stroke: #0000FF; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="45.5" y="1088.0747">Store</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="131" x="84.5" y="1088.0747">service session id</text><rect fill="#DDDDDD" height="42.5938" rx="5" ry="5" style="stroke: #000000; stroke-width: 1.0;" width="398" x="11" y="11"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="17" y="28.9951">Initial request</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="386" x="17" y="45.292">TppBackend that enters embedded authorization mode</text><!--MD5=[10eff5ed1f222a51d27248b718d3d848]
@startuml
legend top left
  <b>Initial request</b>
  TppBackend that enters embedded authorization mode
endlegend

actor FinTech

collections TppBackend

box "TPP API"
control TppBankingApiAisController
control ConsentServiceController
participant FacadeResponseMapper
endbox

box "OPBA-Facade"
collections FacadeService
database Database
participant ServiceContextProvider
participant ProtocolSelector
participant Spring
participant ProtocolResultHandler
endbox

box "XS2A-Protocol"
participant Xs2aListAccountsEntrypoint
participant Xs2aUpdateAuthorization
participant Xs2aFromAspspRedirect
participant Xs2aResultBodyExtractor
collections Xs2aServices
participant OutcomeMapper
endbox

== FinTech asks for user account list ==
FinTech [#blue]-> TppBackend : GET /accounts\n(Fintech user info, bank id, etc.)
TppBackend [#blue]-> TppBankingApiAisController : getAccounts
TppBankingApiAisController [#blue]-> FacadeService : Facade.execute()
FacadeService [#blue]-> ServiceContextProvider : Create facade context from request
FacadeService <-[#blue] ServiceContextProvider : ServiceContext
FacadeService [#blue]-> ProtocolSelector : Select bank protocol from request type and bank id
ProtocolSelector [#blue]-> Database : Read bank protocol using bank uuid and action id
Database [#blue]-> ProtocolSelector : BankProtocol
ProtocolSelector [#blue]-> FacadeService : BankProtocol
FacadeService [#blue]-> Spring : Find bean - Bean(BankProtocol.protocolBeanName) extends Action
FacadeService <-[#blue] Spring : It is Xs2aListAccountsEntrypoint service bean
FacadeService [#blue]-> Xs2aListAccountsEntrypoint : Xs2aListAccountsEntrypoint.execute(ServiceContext)
Xs2aListAccountsEntrypoint [#blue]-> Xs2aServices
Xs2aServices [#blue]-> Database : Consent for service session
Xs2aServices <-[#blue] Database : No consent
Xs2aServices [#blue]-> Xs2aServices : Validate API input -\ndo we have enough data (Mocked execution)
Xs2aServices [#blue]-> Xs2aListAccountsEntrypoint : ValidationIssue[] -> User input has missing parameters
Xs2aListAccountsEntrypoint [#blue]-> OutcomeMapper : Translate ValidationIssue[]
OutcomeMapper [#blue]-> Xs2aListAccountsEntrypoint : ContextBasedValidationErrorResult
Xs2aListAccountsEntrypoint [#blue]-> FacadeService : ContextBasedValidationErrorResult
FacadeService [#blue]-> ProtocolResultHandler : Translate ContextBasedValidationErrorResult -> FacadeStartAuthorizationResult
ProtocolResultHandler [#blue]-> Database : Authorization session present?
Database [#blue]-> ProtocolResultHandler : No authorization session
ProtocolResultHandler [#blue]-> Database : Create authorization session
ProtocolResultHandler [#blue]-> TppBankingApiAisController : process FacadeStartAuthorizationResult
TppBankingApiAisController [#blue]-> FacadeResponseMapper : translate FacadeStartAuthorizationResult
FacadeResponseMapper [#blue]-> TppBankingApiAisController : This is 202 code with redirection to Embedded authorization
TppBankingApiAisController [#blue]-> TppBackend : 202 Embedded authorization
TppBackend [#blue]-> FinTech : 202 Embedded authorization
FinTech [#blue]-> FinTech : Store <b>service session id</b>
@enduml

PlantUML version 1.2019.11(Sun Sep 22 13:02:15 EEST 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_232-release-1638-b6
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>