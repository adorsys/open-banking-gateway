<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1066px" preserveAspectRatio="none" style="width:3007px;height:1066px;" version="1.1" viewBox="0 0 3007 1066" width="3007px" zoomAndPan="magnify"><defs><filter height="300%" id="fbkcukgfg3dcz" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="958.9141" style="stroke: #A80036; stroke-width: 1.0;" width="598" x="435.5" y="96.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="57" x="706" y="108.2544">TPP API</text><rect fill="#DDDDDD" height="958.9141" style="stroke: #A80036; stroke-width: 1.0;" width="807" x="1035.5" y="96.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="100" x="1389" y="108.2544">OPBA-Facade</text><rect fill="#DDDDDD" height="958.9141" style="stroke: #A80036; stroke-width: 1.0;" width="1089" x="1844.5" y="96.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="104" x="2337" y="108.2544">XS2A-Protocol</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="38" x2="38" y1="178.4844" y2="968.8047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="98" x2="98" y1="178.4844" y2="968.8047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="365" x2="365" y1="178.4844" y2="968.8047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="537.5" x2="537.5" y1="178.4844" y2="968.8047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="737.5" x2="737.5" y1="178.4844" y2="968.8047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="933.5" x2="933.5" y1="178.4844" y2="968.8047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1100.5" x2="1100.5" y1="178.4844" y2="968.8047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1207.5" x2="1207.5" y1="178.4844" y2="968.8047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1353.5" x2="1353.5" y1="178.4844" y2="968.8047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1518.5" x2="1518.5" y1="178.4844" y2="968.8047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1625.5" x2="1625.5" y1="178.4844" y2="968.8047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1752.5" x2="1752.5" y1="178.4844" y2="968.8047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1953.5" x2="1953.5" y1="178.4844" y2="968.8047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2164.5" x2="2164.5" y1="178.4844" y2="968.8047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2365.5" x2="2365.5" y1="178.4844" y2="968.8047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2565.5" x2="2565.5" y1="178.4844" y2="968.8047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2728.5" x2="2728.5" y1="178.4844" y2="968.8047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2862.5" x2="2862.5" y1="178.4844" y2="968.8047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2964.5" x2="2964.5" y1="178.4844" y2="968.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="8" y="175.1826">FinTech</text><ellipse cx="38.5" cy="105.1875" fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M38.5,113.1875 L38.5,140.1875 M25.5,121.1875 L51.5,121.1875 M38.5,140.1875 L25.5,155.1875 M38.5,140.1875 L51.5,155.1875 " fill="none" filter="url(#fbkcukgfg3dcz)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="8" y="980.7998">FinTech</text><ellipse cx="38.5" cy="994.1016" fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M38.5,1002.1016 L38.5,1029.1016 M25.5,1010.1016 L51.5,1010.1016 M38.5,1029.1016 L25.5,1044.1016 M38.5,1029.1016 L51.5,1044.1016 " fill="none" filter="url(#fbkcukgfg3dcz)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="79" y="175.1826">User</text><ellipse cx="98" cy="105.1875" fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M98,113.1875 L98,140.1875 M85,121.1875 L111,121.1875 M98,140.1875 L85,155.1875 M98,140.1875 L111,155.1875 " fill="none" filter="url(#fbkcukgfg3dcz)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="79" y="980.7998">User</text><ellipse cx="98" cy="994.1016" fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M98,1002.1016 L98,1029.1016 M85,1010.1016 L111,1010.1016 M98,1029.1016 L85,1044.1016 M98,1029.1016 L111,1044.1016 " fill="none" filter="url(#fbkcukgfg3dcz)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="314" y="139.1875"/><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="310" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="317" y="163.1826">TppBackend</text><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="314" y="967.8047"/><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="310" y="971.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="317" y="991.7998">TppBackend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="191" x="439.5" y="175.1826">TppBankingApiAisController</text><ellipse cx="538" cy="146.1875" fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="534,134.1875,540,129.1875,538,134.1875,540,139.1875,534,134.1875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="191" x="439.5" y="980.7998">TppBankingApiAisController</text><ellipse cx="538" cy="1000.1016" fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="534,988.1016,540,983.1016,538,988.1016,540,993.1016,534,988.1016" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="176" x="646.5" y="175.1826">ConsentServiceController</text><ellipse cx="737.5" cy="146.1875" fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="733.5,134.1875,739.5,129.1875,737.5,134.1875,739.5,139.1875,733.5,134.1875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="176" x="646.5" y="980.7998">ConsentServiceController</text><ellipse cx="737.5" cy="1000.1016" fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="733.5,988.1016,739.5,983.1016,737.5,988.1016,739.5,993.1016,733.5,988.1016" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="187" x="838.5" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="173" x="845.5" y="163.1826">FacadeResponseMapper</text><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="187" x="838.5" y="967.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="173" x="845.5" y="987.7998">FacadeResponseMapper</text><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="1043.5" y="139.1875"/><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="1039.5" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="1046.5" y="163.1826">FacadeService</text><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="1043.5" y="967.8047"/><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="1039.5" y="971.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="1046.5" y="991.7998">FacadeService</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="1171.5" y="175.1826">Database</text><path d="M1189.5,126.1875 C1189.5,116.1875 1207.5,116.1875 1207.5,116.1875 C1207.5,116.1875 1225.5,116.1875 1225.5,126.1875 L1225.5,152.1875 C1225.5,162.1875 1207.5,162.1875 1207.5,162.1875 C1207.5,162.1875 1189.5,162.1875 1189.5,152.1875 L1189.5,126.1875 " fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1189.5,126.1875 C1189.5,136.1875 1207.5,136.1875 1207.5,136.1875 C1207.5,136.1875 1225.5,136.1875 1225.5,126.1875 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="1171.5" y="980.7998">Database</text><path d="M1189.5,994.1016 C1189.5,984.1016 1207.5,984.1016 1207.5,984.1016 C1207.5,984.1016 1225.5,984.1016 1225.5,994.1016 L1225.5,1020.1016 C1225.5,1030.1016 1207.5,1030.1016 1207.5,1030.1016 C1207.5,1030.1016 1189.5,1030.1016 1189.5,1020.1016 L1189.5,994.1016 " fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1189.5,994.1016 C1189.5,1004.1016 1207.5,1004.1016 1207.5,1004.1016 C1207.5,1004.1016 1225.5,1004.1016 1225.5,994.1016 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="1264.5" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="160" x="1271.5" y="163.1826">ServiceContextProvider</text><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="1264.5" y="967.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="160" x="1271.5" y="987.7998">ServiceContextProvider</text><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="128" x="1452.5" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="1459.5" y="163.1826">ProtocolSelector</text><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="128" x="1452.5" y="967.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="1459.5" y="987.7998">ProtocolSelector</text><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="1594.5" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="1601.5" y="163.1826">Spring</text><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="1594.5" y="967.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="1601.5" y="987.7998">Spring</text><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="168" x="1666.5" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1673.5" y="163.1826">ProtocolResultHandler</text><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="168" x="1666.5" y="967.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1673.5" y="987.7998">ProtocolResultHandler</text><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="206" x="1848.5" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="192" x="1855.5" y="163.1826">Xs2aListAccountsEntrypoint</text><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="206" x="1848.5" y="967.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="192" x="1855.5" y="987.7998">Xs2aListAccountsEntrypoint</text><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="189" x="2068.5" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="175" x="2075.5" y="163.1826">Xs2aUpdateAuthorization</text><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="189" x="2068.5" y="967.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="175" x="2075.5" y="987.7998">Xs2aUpdateAuthorization</text><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="184" x="2271.5" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="170" x="2278.5" y="163.1826">Xs2aFromAspspRedirect</text><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="184" x="2271.5" y="967.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="170" x="2278.5" y="987.7998">Xs2aFromAspspRedirect</text><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="188" x="2469.5" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="174" x="2476.5" y="163.1826">Xs2aResultBodyExtractor</text><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="188" x="2469.5" y="967.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="174" x="2476.5" y="987.7998">Xs2aResultBodyExtractor</text><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="2675.5" y="139.1875"/><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="2671.5" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="2678.5" y="163.1826">Xs2aServices</text><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="2675.5" y="967.8047"/><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="2671.5" y="971.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="2678.5" y="991.7998">Xs2aServices</text><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="2795.5" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="2802.5" y="163.1826">OutcomeMapper</text><rect fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="2795.5" y="967.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="2802.5" y="987.7998">OutcomeMapper</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="2939.5" y="175.1826">ASPSP</text><path d="M2944.5,134.1875 L2944.5,158.1875 M2944.5,146.1875 L2961.5,146.1875 " fill="none" filter="url(#fbkcukgfg3dcz)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="2973.5" cy="146.1875" fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="2939.5" y="980.7998">ASPSP</text><path d="M2944.5,988.1016 L2944.5,1012.1016 M2944.5,1000.1016 L2961.5,1000.1016 " fill="none" filter="url(#fbkcukgfg3dcz)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="2973.5" cy="1000.1016" fill="#FEFECE" filter="url(#fbkcukgfg3dcz)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#EEEEEE" filter="url(#fbkcukgfg3dcz)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2992.5" x="3" y="209.0508"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2995.5" y1="209.0508" y2="209.0508"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2995.5" y1="212.0508" y2="212.0508"/><rect fill="#EEEEEE" filter="url(#fbkcukgfg3dcz)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="317" x="1340.75" y="198.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="298" x="1346.75" y="214.5513">ASPSP reports consent authorization OK</text><polygon fill="#FF00FF" points="109,248.75,99,252.75,109,256.75,105,252.75" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="103" x2="2964" y1="252.75" y2="252.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="34" x="115" y="247.6841">Done</text><polygon fill="#FF00FF" points="376,277.8828,366,281.8828,376,285.8828,372,281.8828" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="370" x2="2964" y1="281.8828" y2="281.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="382" y="276.8169">GET /from/aspsp/ok webhook</text><polygon fill="#FF00FF" points="725.5,307.0156,735.5,311.0156,725.5,315.0156,729.5,311.0156" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="365" x2="731.5" y1="311.0156" y2="311.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="372" y="305.9497">fromAspspOkUsingGET</text><polygon fill="#FF00FF" points="1088.5,336.1484,1098.5,340.1484,1088.5,344.1484,1092.5,340.1484" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="737.5" x2="1094.5" y1="340.1484" y2="340.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="744.5" y="335.0825">Facade.execute()</text><polygon fill="#FF00FF" points="1341.5,365.2813,1351.5,369.2813,1341.5,373.2813,1345.5,369.2813" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="1100.5" x2="1347.5" y1="369.2813" y2="369.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="1107.5" y="364.2153">Create facade context from request</text><polygon fill="#FF00FF" points="1111.5,394.4141,1101.5,398.4141,1111.5,402.4141,1107.5,398.4141" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="1105.5" x2="1352.5" y1="398.4141" y2="398.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="1117.5" y="393.3481">ServiceContext</text><polygon fill="#FF00FF" points="1506.5,423.5469,1516.5,427.5469,1506.5,431.5469,1510.5,427.5469" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="1100.5" x2="1512.5" y1="427.5469" y2="427.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="343" x="1107.5" y="422.481">Select bank protocol by using authorization session id</text><polygon fill="#FF00FF" points="1218.5,452.6797,1208.5,456.6797,1218.5,460.6797,1214.5,456.6797" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="1212.5" x2="1517.5" y1="456.6797" y2="456.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="1224.5" y="451.6138">Read authorization session</text><polygon fill="#FF00FF" points="1506.5,481.8125,1516.5,485.8125,1506.5,489.8125,1510.5,485.8125" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="1207.5" x2="1512.5" y1="485.8125" y2="485.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="1214.5" y="480.7466">Bank protocol id from authorization session</text><polygon fill="#FF00FF" points="1111.5,510.9453,1101.5,514.9453,1111.5,518.9453,1107.5,514.9453" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="1105.5" x2="1517.5" y1="514.9453" y2="514.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="1117.5" y="509.8794">BankProtocol</text><polygon fill="#FF00FF" points="1613.5,540.0781,1623.5,544.0781,1613.5,548.0781,1617.5,544.0781" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="1100.5" x2="1619.5" y1="544.0781" y2="544.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="429" x="1107.5" y="539.0122">Find bean - Bean(BankProtocol.protocolBeanName) extends Action</text><polygon fill="#FF00FF" points="1111.5,569.2109,1101.5,573.2109,1111.5,577.2109,1107.5,573.2109" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="1105.5" x2="1624.5" y1="573.2109" y2="573.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="1117.5" y="568.145">It is Xs2aFromAspspRedirect service bean</text><polygon fill="#FF00FF" points="2716.5,598.3438,2726.5,602.3438,2716.5,606.3438,2720.5,602.3438" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="2365.5" x2="2722.5" y1="602.3438" y2="602.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="2372.5" y="597.2778">Bank approved consent</text><polygon fill="#FF00FF" points="1218.5,627.4766,1208.5,631.4766,1218.5,635.4766,1214.5,631.4766" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="1212.5" x2="2727.5" y1="631.4766" y2="631.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="1224.5" y="626.4106">Persist consent and its context</text><polygon fill="#FF00FF" points="2376.5,656.6094,2366.5,660.6094,2376.5,664.6094,2372.5,660.6094" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="2370.5" x2="2727.5" y1="660.6094" y2="660.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="2382.5" y="655.5435">Consent acquired</text><polygon fill="#FF00FF" points="2850.5,685.7422,2860.5,689.7422,2850.5,693.7422,2854.5,689.7422" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="2365.5" x2="2856.5" y1="689.7422" y2="689.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="2372.5" y="684.6763">Translate 'Consent acquired'</text><polygon fill="#FF00FF" points="2376.5,714.875,2366.5,718.875,2376.5,722.875,2372.5,718.875" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="2370.5" x2="2861.5" y1="718.875" y2="718.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="2382.5" y="713.8091">ConsentAcquiredResult</text><polygon fill="#FF00FF" points="1111.5,744.0078,1101.5,748.0078,1111.5,752.0078,1107.5,748.0078" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="1105.5" x2="2364.5" y1="748.0078" y2="748.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="1117.5" y="742.9419">ConsentAcquiredResult</text><polygon fill="#FF00FF" points="1740.5,773.1406,1750.5,777.1406,1740.5,781.1406,1744.5,777.1406" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="1100.5" x2="1746.5" y1="777.1406" y2="777.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="372" x="1107.5" y="772.0747">Translate ConsentAcquiredResult -&gt; FacadeRedirectResult</text><polygon fill="#FF00FF" points="922,802.2734,932,806.2734,922,810.2734,926,806.2734" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="538" x2="928" y1="806.2734" y2="806.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="545" y="801.2075">translate FacadeRedirectResult</text><polygon fill="#FF00FF" points="549,831.4063,539,835.4063,549,839.4063,545,835.4063" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="543" x2="933" y1="835.4063" y2="835.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="555" y="830.3403">This is 303 code with redirection to FinTech</text><polygon fill="#FF00FF" points="376,860.5391,366,864.5391,376,868.5391,372,864.5391" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="370" x2="537" y1="864.5391" y2="864.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="382" y="859.4731">303 Redirect to FinTech</text><polygon fill="#FF00FF" points="109,889.6719,99,893.6719,109,897.6719,105,893.6719" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="103" x2="364" y1="893.6719" y2="893.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="115" y="888.606">303 FinTech 'Thanks for consent' page</text><rect fill="#EEEEEE" filter="url(#fbkcukgfg3dcz)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2992.5" x="3" y="922.2383"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2995.5" y1="922.2383" y2="922.2383"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2995.5" y1="925.2383" y2="925.2383"/><rect fill="#EEEEEE" filter="url(#fbkcukgfg3dcz)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="410" x="1294.25" y="911.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="391" x="1300.25" y="927.7388">Fintech receives notification that consent is received</text><polygon fill="#FFA500" points="49.5,946.8047,39.5,950.8047,49.5,954.8047,45.5,950.8047" style="stroke: #FFA500; stroke-width: 1.0;"/><line style="stroke: #FFA500; stroke-width: 1.0;" x1="43.5" x2="97" y1="950.8047" y2="950.8047"/><rect fill="#DDDDDD" height="75.1875" rx="5" ry="5" style="stroke: #000000; stroke-width: 1.0;" width="299" x="11" y="11"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="79" x="17" y="28.9951">Combined</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="242" x="17" y="45.292">embedded (Extra user parameters)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="236" x="17" y="61.5889">and redirect (ASPSP authorization)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="132" x="17" y="77.8857">authorization when</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="147" x="157" y="77.8857">consent is missing</text><!--MD5=[e681ba52350460e1e594bc8b43309dd6]
@startuml
legend top left
  <b>Combined</b>
  embedded (Extra user parameters)
  and redirect (ASPSP authorization)
  authorization when  <b>consent is missing</b>
endlegend

actor FinTech
actor User

collections TppBackend

box "TPP API"
control TppBankingApiAisController
control ConsentServiceController
participant FacadeResponseMapper
endbox

box "OPBA-Facade"
collections FacadeService
database Database
participant ServiceContextProvider
participant ProtocolSelector
participant Spring
participant ProtocolResultHandler
endbox

box "XS2A-Protocol"
participant Xs2aListAccountsEntrypoint
participant Xs2aUpdateAuthorization
participant Xs2aFromAspspRedirect
participant Xs2aResultBodyExtractor
collections Xs2aServices
participant OutcomeMapper
endbox

boundary ASPSP
== ASPSP reports consent authorization OK ==
ASPSP [#magenta]-> User : Done
ASPSP [#magenta]-> TppBackend : GET /from/aspsp/ok webhook
TppBackend [#magenta]-> ConsentServiceController : fromAspspOkUsingGET
ConsentServiceController [#magenta]-> FacadeService : Facade.execute()
FacadeService [#magenta]-> ServiceContextProvider : Create facade context from request
FacadeService <-[#magenta] ServiceContextProvider : ServiceContext
FacadeService [#magenta]-> ProtocolSelector : Select bank protocol by using authorization session id
ProtocolSelector [#magenta]-> Database : Read authorization session
Database [#magenta]-> ProtocolSelector: Bank protocol id from authorization session
ProtocolSelector [#magenta]-> FacadeService : BankProtocol
FacadeService [#magenta]-> Spring : Find bean - Bean(BankProtocol.protocolBeanName) extends Action
FacadeService <-[#magenta] Spring : It is Xs2aFromAspspRedirect service bean
Xs2aFromAspspRedirect [#magenta]-> Xs2aServices : Bank approved consent
Xs2aServices [#magenta]-> Database : Persist consent and its context
Xs2aServices [#magenta]-> Xs2aFromAspspRedirect : Consent acquired
Xs2aFromAspspRedirect [#magenta]-> OutcomeMapper : Translate 'Consent acquired'
OutcomeMapper [#magenta]-> Xs2aFromAspspRedirect : ConsentAcquiredResult
Xs2aFromAspspRedirect [#magenta]-> FacadeService : ConsentAcquiredResult
FacadeService [#magenta]-> ProtocolResultHandler : Translate ConsentAcquiredResult -> FacadeRedirectResult
TppBankingApiAisController [#magenta]-> FacadeResponseMapper : translate FacadeRedirectResult
FacadeResponseMapper [#magenta]-> TppBankingApiAisController : This is 303 code with redirection to FinTech
TppBankingApiAisController [#magenta]-> TppBackend : 303 Redirect to FinTech
TppBackend [#magenta]-> User : 303 FinTech 'Thanks for consent' page

== Fintech receives notification that consent is received ==
User [#orange]-> FinTech
@enduml

PlantUML version 1.2019.11(Sun Sep 22 13:02:15 EEST 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_232-release-1638-b6
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>
