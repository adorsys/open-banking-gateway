<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3799px" preserveAspectRatio="none" style="width:3395px;height:3799px;" version="1.1" viewBox="0 0 3395 3799" width="3395px" zoomAndPan="magnify"><defs><filter height="300%" id="fua4d6lni00q4" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="3692.1328" style="stroke: #A80036; stroke-width: 1.0;" width="617" x="638" y="96.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="57" x="918" y="108.2544">TPP API</text><rect fill="#DDDDDD" height="3692.1328" style="stroke: #A80036; stroke-width: 1.0;" width="807" x="1257" y="96.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="100" x="1610.5" y="108.2544">OPBA-Facade</text><rect fill="#DDDDDD" height="3692.1328" style="stroke: #A80036; stroke-width: 1.0;" width="1255" x="2066" y="96.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="104" x="2641.5" y="108.2544">XS2A-Protocol</text><rect fill="#FFFFFF" filter="url(#fua4d6lni00q4)" height="381.8594" style="stroke: #000000; stroke-width: 2.0;" width="2802.5" x="214.5" y="1198"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="38" x2="38" y1="178.4844" y2="3702.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="243.5" x2="243.5" y1="178.4844" y2="3702.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="531.5" x2="531.5" y1="178.4844" y2="3702.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="740" x2="740" y1="178.4844" y2="3702.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="940" x2="940" y1="178.4844" y2="3702.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1155" x2="1155" y1="178.4844" y2="3702.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1322" x2="1322" y1="178.4844" y2="3702.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1429" x2="1429" y1="178.4844" y2="3702.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1575" x2="1575" y1="178.4844" y2="3702.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1740" x2="1740" y1="178.4844" y2="3702.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1847" x2="1847" y1="178.4844" y2="3702.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1974" x2="1974" y1="178.4844" y2="3702.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2175" x2="2175" y1="178.4844" y2="3702.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2386" x2="2386" y1="178.4844" y2="3702.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2587" x2="2587" y1="178.4844" y2="3702.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2787" x2="2787" y1="178.4844" y2="3702.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2950" x2="2950" y1="178.4844" y2="3702.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3250" x2="3250" y1="178.4844" y2="3702.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3352" x2="3352" y1="178.4844" y2="3702.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="8" y="175.1826">FinTech</text><ellipse cx="38.5" cy="105.1875" fill="#FEFECE" filter="url(#fua4d6lni00q4)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M38.5,113.1875 L38.5,140.1875 M25.5,121.1875 L51.5,121.1875 M38.5,140.1875 L25.5,155.1875 M38.5,140.1875 L51.5,155.1875 " fill="none" filter="url(#fua4d6lni00q4)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="8" y="3714.0186">FinTech</text><ellipse cx="38.5" cy="3727.3203" fill="#FEFECE" filter="url(#fua4d6lni00q4)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M38.5,3735.3203 L38.5,3762.3203 M25.5,3743.3203 L51.5,3743.3203 M38.5,3762.3203 L25.5,3777.3203 M38.5,3762.3203 L51.5,3777.3203 " fill="none" filter="url(#fua4d6lni00q4)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="224.5" y="175.1826">User</text><ellipse cx="243.5" cy="105.1875" fill="#FEFECE" filter="url(#fua4d6lni00q4)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M243.5,113.1875 L243.5,140.1875 M230.5,121.1875 L256.5,121.1875 M243.5,140.1875 L230.5,155.1875 M243.5,140.1875 L256.5,155.1875 " fill="none" filter="url(#fua4d6lni00q4)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="224.5" y="3714.0186">User</text><ellipse cx="243.5" cy="3727.3203" fill="#FEFECE" filter="url(#fua4d6lni00q4)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M243.5,3735.3203 L243.5,3762.3203 M230.5,3743.3203 L256.5,3743.3203 M243.5,3762.3203 L230.5,3777.3203 M243.5,3762.3203 L256.5,3777.3203 " fill="none" filter="url(#fua4d6lni00q4)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="480.5" y="139.1875"/><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="476.5" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="483.5" y="163.1826">TppBackend</text><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="480.5" y="3701.0234"/><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="476.5" y="3705.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="483.5" y="3725.0186">TppBackend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="191" x="642" y="175.1826">TppBankingApiAisController</text><ellipse cx="740.5" cy="146.1875" fill="#FEFECE" filter="url(#fua4d6lni00q4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="736.5,134.1875,742.5,129.1875,740.5,134.1875,742.5,139.1875,736.5,134.1875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="191" x="642" y="3714.0186">TppBankingApiAisController</text><ellipse cx="740.5" cy="3733.3203" fill="#FEFECE" filter="url(#fua4d6lni00q4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="736.5,3721.3203,742.5,3716.3203,740.5,3721.3203,742.5,3726.3203,736.5,3721.3203" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="176" x="849" y="175.1826">ConsentServiceController</text><ellipse cx="940" cy="146.1875" fill="#FEFECE" filter="url(#fua4d6lni00q4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="936,134.1875,942,129.1875,940,134.1875,942,139.1875,936,134.1875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="176" x="849" y="3714.0186">ConsentServiceController</text><ellipse cx="940" cy="3733.3203" fill="#FEFECE" filter="url(#fua4d6lni00q4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="936,3721.3203,942,3716.3203,940,3721.3203,942,3726.3203,936,3721.3203" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="187" x="1060" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="173" x="1067" y="163.1826">FacadeResponseMapper</text><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="187" x="1060" y="3701.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="173" x="1067" y="3721.0186">FacadeResponseMapper</text><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="1265" y="139.1875"/><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="1261" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="1268" y="163.1826">FacadeService</text><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="1265" y="3701.0234"/><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="1261" y="3705.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="1268" y="3725.0186">FacadeService</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="1393" y="175.1826">Database</text><path d="M1411,126.1875 C1411,116.1875 1429,116.1875 1429,116.1875 C1429,116.1875 1447,116.1875 1447,126.1875 L1447,152.1875 C1447,162.1875 1429,162.1875 1429,162.1875 C1429,162.1875 1411,162.1875 1411,152.1875 L1411,126.1875 " fill="#FEFECE" filter="url(#fua4d6lni00q4)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1411,126.1875 C1411,136.1875 1429,136.1875 1429,136.1875 C1429,136.1875 1447,136.1875 1447,126.1875 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="1393" y="3714.0186">Database</text><path d="M1411,3727.3203 C1411,3717.3203 1429,3717.3203 1429,3717.3203 C1429,3717.3203 1447,3717.3203 1447,3727.3203 L1447,3753.3203 C1447,3763.3203 1429,3763.3203 1429,3763.3203 C1429,3763.3203 1411,3763.3203 1411,3753.3203 L1411,3727.3203 " fill="#FEFECE" filter="url(#fua4d6lni00q4)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1411,3727.3203 C1411,3737.3203 1429,3737.3203 1429,3737.3203 C1429,3737.3203 1447,3737.3203 1447,3727.3203 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="1486" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="160" x="1493" y="163.1826">ServiceContextProvider</text><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="1486" y="3701.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="160" x="1493" y="3721.0186">ServiceContextProvider</text><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="128" x="1674" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="1681" y="163.1826">ProtocolSelector</text><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="128" x="1674" y="3701.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="1681" y="3721.0186">ProtocolSelector</text><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="1816" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="1823" y="163.1826">Spring</text><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="1816" y="3701.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="1823" y="3721.0186">Spring</text><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="168" x="1888" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1895" y="163.1826">ProtocolResultHandler</text><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="168" x="1888" y="3701.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1895" y="3721.0186">ProtocolResultHandler</text><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="206" x="2070" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="192" x="2077" y="163.1826">Xs2aListAccountsEntrypoint</text><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="206" x="2070" y="3701.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="192" x="2077" y="3721.0186">Xs2aListAccountsEntrypoint</text><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="189" x="2290" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="175" x="2297" y="163.1826">Xs2aUpdateAuthorization</text><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="189" x="2290" y="3701.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="175" x="2297" y="3721.0186">Xs2aUpdateAuthorization</text><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="184" x="2493" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="170" x="2500" y="163.1826">Xs2aFromAspspRedirect</text><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="184" x="2493" y="3701.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="170" x="2500" y="3721.0186">Xs2aFromAspspRedirect</text><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="188" x="2691" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="174" x="2698" y="163.1826">Xs2aResultBodyExtractor</text><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="188" x="2691" y="3701.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="174" x="2698" y="3721.0186">Xs2aResultBodyExtractor</text><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="2897" y="139.1875"/><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="2893" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="2900" y="163.1826">Xs2aServices</text><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="2897" y="3701.0234"/><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="2893" y="3705.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="2900" y="3725.0186">Xs2aServices</text><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="3183" y="143.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="3190" y="163.1826">OutcomeMapper</text><rect fill="#FEFECE" filter="url(#fua4d6lni00q4)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="3183" y="3701.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="3190" y="3721.0186">OutcomeMapper</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="3327" y="175.1826">ASPSP</text><path d="M3332,134.1875 L3332,158.1875 M3332,146.1875 L3349,146.1875 " fill="none" filter="url(#fua4d6lni00q4)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="3361" cy="146.1875" fill="#FEFECE" filter="url(#fua4d6lni00q4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="3327" y="3714.0186">ASPSP</text><path d="M3332,3721.3203 L3332,3745.3203 M3332,3733.3203 L3349,3733.3203 " fill="none" filter="url(#fua4d6lni00q4)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="3361" cy="3733.3203" fill="#FEFECE" filter="url(#fua4d6lni00q4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#EEEEEE" filter="url(#fua4d6lni00q4)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3380" x="3" y="209.0508"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3383" y1="209.0508" y2="209.0508"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3383" y1="212.0508" y2="212.0508"/><rect fill="#EEEEEE" filter="url(#fua4d6lni00q4)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="267" x="1559.5" y="198.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="248" x="1565.5" y="214.5513">FinTech asks for user account list</text><polygon fill="#0000FF" points="519.5,263.8828,529.5,267.8828,519.5,271.8828,523.5,267.8828" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="38.5" x2="525.5" y1="267.8828" y2="267.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="45.5" y="247.6841">GET /accounts</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="45.5" y="262.8169">(Fintech user info, bank id, etc.)</text><polygon fill="#0000FF" points="728.5,293.0156,738.5,297.0156,728.5,301.0156,732.5,297.0156" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="531.5" x2="734.5" y1="297.0156" y2="297.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="538.5" y="291.9497">getAccounts</text><polygon fill="#0000FF" points="1310,322.1484,1320,326.1484,1310,330.1484,1314,326.1484" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="740.5" x2="1316" y1="326.1484" y2="326.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="747.5" y="321.0825">Facade.execute()</text><polygon fill="#0000FF" points="1563,351.2813,1573,355.2813,1563,359.2813,1567,355.2813" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1322" x2="1569" y1="355.2813" y2="355.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="1329" y="350.2153">Create facade context from request</text><polygon fill="#0000FF" points="1333,380.4141,1323,384.4141,1333,388.4141,1329,384.4141" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1327" x2="1574" y1="384.4141" y2="384.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="1339" y="379.3481">ServiceContext</text><polygon fill="#0000FF" points="1728,409.5469,1738,413.5469,1728,417.5469,1732,413.5469" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1322" x2="1734" y1="413.5469" y2="413.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="328" x="1329" y="408.481">Select bank protocol from request type and bank id</text><polygon fill="#0000FF" points="1333,438.6797,1323,442.6797,1333,446.6797,1329,442.6797" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1327" x2="1739" y1="442.6797" y2="442.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="1339" y="437.6138">BankProtocol</text><polygon fill="#0000FF" points="1835,467.8125,1845,471.8125,1835,475.8125,1839,471.8125" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1322" x2="1841" y1="471.8125" y2="471.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="429" x="1329" y="466.7466">Find bean - Bean(BankProtocol.protocolBeanName) extends Action</text><polygon fill="#0000FF" points="1333,496.9453,1323,500.9453,1333,504.9453,1329,500.9453" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1327" x2="1846" y1="500.9453" y2="500.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="1339" y="495.8794">It is Xs2aListAccountsEntrypoint service bean</text><polygon fill="#0000FF" points="2163,526.0781,2173,530.0781,2163,534.0781,2167,530.0781" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1322" x2="2169" y1="530.0781" y2="530.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="339" x="1329" y="525.0122">Xs2aListAccountsEntrypoint.execute(ServiceContext)</text><polygon fill="#0000FF" points="2938,540.0781,2948,544.0781,2938,548.0781,2942,544.0781" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="2175" x2="2944" y1="544.0781" y2="544.0781"/><polygon fill="#0000FF" points="1440,569.2109,1430,573.2109,1440,577.2109,1436,573.2109" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1434" x2="2949" y1="573.2109" y2="573.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="1446" y="568.145">Consent for service session</text><polygon fill="#0000FF" points="2938,598.3438,2948,602.3438,2938,606.3438,2942,602.3438" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1429" x2="2944" y1="602.3438" y2="602.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="1436" y="597.2778">No consent</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="2950" x2="2992" y1="646.6094" y2="646.6094"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="2992" x2="2992" y1="646.6094" y2="659.6094"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="2951" x2="2992" y1="659.6094" y2="659.6094"/><polygon fill="#0000FF" points="2961,655.6094,2951,659.6094,2961,663.6094,2957,659.6094" style="stroke: #0000FF; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="2957" y="626.4106">Validate API input -</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="2957" y="641.5435">do we have enough data (Mocked execution)</text><polygon fill="#0000FF" points="2186,684.7422,2176,688.7422,2186,692.7422,2182,688.7422" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="2180" x2="2949" y1="688.7422" y2="688.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="355" x="2192" y="683.6763">ValidationIssue[] -&gt; User input has missing parameters</text><polygon fill="#0000FF" points="3238,713.875,3248,717.875,3238,721.875,3242,717.875" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="2175" x2="3244" y1="717.875" y2="717.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="2182" y="712.8091">Translate ValidationIssue[]</text><polygon fill="#0000FF" points="2186,743.0078,2176,747.0078,2186,751.0078,2182,747.0078" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="2180" x2="3249" y1="747.0078" y2="747.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="2192" y="741.9419">ContextBasedValidationErrorResult</text><polygon fill="#0000FF" points="1333,772.1406,1323,776.1406,1333,780.1406,1329,776.1406" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1327" x2="2174" y1="776.1406" y2="776.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="1339" y="771.0747">ContextBasedValidationErrorResult</text><polygon fill="#0000FF" points="1962,801.2734,1972,805.2734,1962,809.2734,1966,805.2734" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1322" x2="1968" y1="805.2734" y2="805.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="512" x="1329" y="800.2075">Translate ContextBasedValidationErrorResult -&gt; FacadeStartAuthorizationResult</text><polygon fill="#0000FF" points="1440,830.4063,1430,834.4063,1440,838.4063,1436,834.4063" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1434" x2="1973" y1="834.4063" y2="834.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="1446" y="829.3403">Authorization session present?</text><polygon fill="#0000FF" points="1962,859.5391,1972,863.5391,1962,867.5391,1966,863.5391" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1429" x2="1968" y1="863.5391" y2="863.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1436" y="858.4731">No authorization session</text><polygon fill="#0000FF" points="1440,888.6719,1430,892.6719,1440,896.6719,1436,892.6719" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1434" x2="1973" y1="892.6719" y2="892.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="1446" y="887.606">Create authorization session</text><polygon fill="#0000FF" points="751.5,917.8047,741.5,921.8047,751.5,925.8047,747.5,921.8047" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="745.5" x2="1973" y1="921.8047" y2="921.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="757.5" y="916.7388">process FacadeStartAuthorizationResult</text><polygon fill="#0000FF" points="1143.5,946.9375,1153.5,950.9375,1143.5,954.9375,1147.5,950.9375" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="740.5" x2="1149.5" y1="950.9375" y2="950.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="263" x="747.5" y="945.8716">translate FacadeStartAuthorizationResult</text><polygon fill="#0000FF" points="751.5,976.0703,741.5,980.0703,751.5,984.0703,747.5,980.0703" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="745.5" x2="1154.5" y1="980.0703" y2="980.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="381" x="757.5" y="975.0044">This is 202 code with redirection to Embedded authorization</text><polygon fill="#0000FF" points="542.5,1005.2031,532.5,1009.2031,542.5,1013.2031,538.5,1009.2031" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="536.5" x2="739.5" y1="1009.2031" y2="1009.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="548.5" y="1004.1372">202 Embedded authorization</text><polygon fill="#0000FF" points="49.5,1034.3359,39.5,1038.3359,49.5,1042.3359,45.5,1038.3359" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="43.5" x2="530.5" y1="1038.3359" y2="1038.3359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="55.5" y="1033.27">202 Embedded authorization</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="38.5" x2="80.5" y1="1067.4688" y2="1067.4688"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="80.5" x2="80.5" y1="1067.4688" y2="1080.4688"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="39.5" x2="80.5" y1="1080.4688" y2="1080.4688"/><polygon fill="#0000FF" points="49.5,1076.4688,39.5,1080.4688,49.5,1084.4688,45.5,1080.4688" style="stroke: #0000FF; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="45.5" y="1062.4028">Store</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="131" x="84.5" y="1062.4028">service session id</text><polygon fill="#FFA500" points="231.5,1135.8672,241.5,1139.8672,231.5,1143.8672,235.5,1139.8672" style="stroke: #FFA500; stroke-width: 1.0;"/><line style="stroke: #FFA500; stroke-width: 1.0;" x1="38.5" x2="237.5" y1="1139.8672" y2="1139.8672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="45.5" y="1104.5356">Redirect user to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="45.5" y="1119.6685">'Embedded authorization'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="45.5" y="1134.8013">form using 'Location' header</text><rect fill="#EEEEEE" filter="url(#fua4d6lni00q4)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3380" x="3" y="1168.4336"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3383" y1="1168.4336" y2="1168.4336"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3383" y1="1171.4336" y2="1171.4336"/><rect fill="#EEEEEE" filter="url(#fua4d6lni00q4)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="488" x="1449" y="1157.8672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="469" x="1455" y="1173.9341">User authorizes this request (embedded to provide i.e. PSU id)</text><path d="M214.5,1198 L291.5,1198 L291.5,1205 L281.5,1215 L214.5,1215 L214.5,1198 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="381.8594" style="stroke: #000000; stroke-width: 2.0;" width="2802.5" x="214.5" y="1198"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="229.5" y="1211.0669">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="290" x="306.5" y="1210.2104">[Until user input has not enough parameters]</text><polygon fill="#008000" points="519.5,1247.3984,529.5,1251.3984,519.5,1255.3984,523.5,1251.3984" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="243.5" x2="525.5" y1="1251.3984" y2="1251.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="250.5" y="1231.1997">POST /consent/embedded</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="250.5" y="1246.3325">(Consent valid until, which accounts, etc.)</text><polygon fill="#008000" points="928,1276.5313,938,1280.5313,928,1284.5313,932,1280.5313" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="531.5" x2="934" y1="1280.5313" y2="1280.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="538.5" y="1275.4653">embeddedUsingPOST</text><polygon fill="#008000" points="1310,1305.6641,1320,1309.6641,1310,1313.6641,1314,1309.6641" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="940" x2="1316" y1="1309.6641" y2="1309.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="947" y="1304.5981">Facade.execute()</text><polygon fill="#008000" points="1563,1334.7969,1573,1338.7969,1563,1342.7969,1567,1338.7969" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1322" x2="1569" y1="1338.7969" y2="1338.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="1329" y="1333.731">Create facade context from request</text><polygon fill="#008000" points="1333,1363.9297,1323,1367.9297,1333,1371.9297,1329,1367.9297" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1327" x2="1574" y1="1367.9297" y2="1367.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="1339" y="1362.8638">ServiceContext</text><polygon fill="#008000" points="1728,1393.0625,1738,1397.0625,1728,1401.0625,1732,1397.0625" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1322" x2="1734" y1="1397.0625" y2="1397.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="343" x="1329" y="1391.9966">Select bank protocol by using authorization session id</text><polygon fill="#008000" points="1440,1422.1953,1430,1426.1953,1440,1430.1953,1436,1426.1953" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1434" x2="1739" y1="1426.1953" y2="1426.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="1446" y="1421.1294">Read authorization session</text><polygon fill="#008000" points="1728,1451.3281,1738,1455.3281,1728,1459.3281,1732,1455.3281" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1429" x2="1734" y1="1455.3281" y2="1455.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="1436" y="1450.2622">Bank protocol id from authorization session</text><polygon fill="#008000" points="1333,1480.4609,1323,1484.4609,1333,1488.4609,1329,1484.4609" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1327" x2="1739" y1="1484.4609" y2="1484.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="1339" y="1479.395">BankProtocol</text><polygon fill="#008000" points="1835,1509.5938,1845,1513.5938,1835,1517.5938,1839,1513.5938" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1322" x2="1841" y1="1513.5938" y2="1513.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="429" x="1329" y="1508.5278">Find bean - Bean(BankProtocol.protocolBeanName) extends Action</text><polygon fill="#008000" points="1333,1538.7266,1323,1542.7266,1333,1546.7266,1329,1542.7266" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1327" x2="1846" y1="1542.7266" y2="1542.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="1339" y="1537.6606">It is Xs2aUpdateAuthorization service bean</text><polygon fill="#008000" points="2938,1567.8594,2948,1571.8594,2938,1575.8594,2942,1571.8594" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="2386.5" x2="2944" y1="1571.8594" y2="1571.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="2393.5" y="1566.7935">Update context with users' input</text><line style="stroke: #008000; stroke-width: 1.0;" x1="2950" x2="2992" y1="1607.9922" y2="1607.9922"/><line style="stroke: #008000; stroke-width: 1.0;" x1="2992" x2="2992" y1="1607.9922" y2="1620.9922"/><line style="stroke: #008000; stroke-width: 1.0;" x1="2951" x2="2992" y1="1620.9922" y2="1620.9922"/><polygon fill="#008000" points="2961,1616.9922,2951,1620.9922,2961,1624.9922,2957,1620.9922" style="stroke: #008000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="2957" y="1602.9263">User input OK</text><line style="stroke: #008000; stroke-width: 1.0;" x1="2950" x2="2992" y1="1650.125" y2="1650.125"/><line style="stroke: #008000; stroke-width: 1.0;" x1="2992" x2="2992" y1="1650.125" y2="1663.125"/><line style="stroke: #008000; stroke-width: 1.0;" x1="2951" x2="2992" y1="1663.125" y2="1663.125"/><polygon fill="#008000" points="2961,1659.125,2951,1663.125,2961,1667.125,2957,1663.125" style="stroke: #008000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="2957" y="1645.0591">Switch to real execution mode</text><polygon fill="#008000" points="3340.5,1688.2578,3350.5,1692.2578,3340.5,1696.2578,3344.5,1692.2578" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="2950" x2="3346.5" y1="1692.2578" y2="1692.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="2957" y="1687.1919">Initiate consent</text><polygon fill="#008000" points="2961,1717.3906,2951,1721.3906,2961,1725.3906,2957,1721.3906" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="2955" x2="3351.5" y1="1721.3906" y2="1721.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="2967" y="1716.3247">Redirect authorization required</text><polygon fill="#008000" points="2186,1746.5234,2176,1750.5234,2186,1754.5234,2182,1750.5234" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="2180" x2="2949" y1="1750.5234" y2="1750.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173" x="2192" y="1745.4575">Redirect to ASPSP required</text><polygon fill="#008000" points="3238,1775.6563,3248,1779.6563,3238,1783.6563,3242,1779.6563" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="2175" x2="3244" y1="1779.6563" y2="1779.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="2182" y="1774.5903">Translate 'Redirect to ASPSP required'</text><polygon fill="#008000" points="2186,1804.7891,2176,1808.7891,2186,1812.7891,2182,1808.7891" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="2180" x2="3249" y1="1808.7891" y2="1808.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="270" x="2192" y="1803.7231">ContextBasedAuthorizationRequiredResult</text><polygon fill="#008000" points="1333,1833.9219,1323,1837.9219,1333,1841.9219,1329,1837.9219" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1327" x2="2174" y1="1837.9219" y2="1837.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="270" x="1339" y="1832.856">ContextBasedAuthorizationRequiredResult</text><polygon fill="#008000" points="1962,1863.0547,1972,1867.0547,1962,1871.0547,1966,1867.0547" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="1322" x2="1968" y1="1867.0547" y2="1867.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="426" x="1329" y="1861.9888">Translate FacadeStartAuthorizationResult -&gt; FacadeRedirectResult</text><polygon fill="#008000" points="1143.5,1892.1875,1153.5,1896.1875,1143.5,1900.1875,1147.5,1896.1875" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="740.5" x2="1149.5" y1="1896.1875" y2="1896.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="747.5" y="1891.1216">translate FacadeRedirectResult</text><polygon fill="#008000" points="751.5,1921.3203,741.5,1925.3203,751.5,1929.3203,747.5,1925.3203" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="745.5" x2="1154.5" y1="1925.3203" y2="1925.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="391" x="757.5" y="1920.2544">This is 303 code with redirection to ASPSP authorization page</text><polygon fill="#008000" points="542.5,1950.4531,532.5,1954.4531,542.5,1958.4531,538.5,1954.4531" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="536.5" x2="739.5" y1="1954.4531" y2="1954.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="548.5" y="1949.3872">303 Redirect to ASPSP</text><polygon fill="#008000" points="254.5,1979.5859,244.5,1983.5859,254.5,1987.5859,250.5,1983.5859" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="248.5" x2="530.5" y1="1983.5859" y2="1983.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="260.5" y="1978.52">303 ASPSP 'Login page'</text><rect fill="#EEEEEE" filter="url(#fua4d6lni00q4)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3380" x="3" y="2012.1523"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3383" y1="2012.1523" y2="2012.1523"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3383" y1="2015.1523" y2="2015.1523"/><rect fill="#EEEEEE" filter="url(#fua4d6lni00q4)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="392" x="1497" y="2001.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="373" x="1503" y="2017.6528">User authorizes this request with ASPSP (redirect)</text><polygon fill="#FFA500" points="3340.5,2051.8516,3350.5,2055.8516,3340.5,2059.8516,3344.5,2055.8516" style="stroke: #FFA500; stroke-width: 1.0;"/><line style="stroke: #FFA500; stroke-width: 1.0;" x1="243.5" x2="3346.5" y1="2055.8516" y2="2055.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="250.5" y="2050.7856">Authorization</text><rect fill="#EEEEEE" filter="url(#fua4d6lni00q4)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3380" x="3" y="2084.418"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3383" y1="2084.418" y2="2084.418"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3383" y1="2087.418" y2="2087.418"/><rect fill="#EEEEEE" filter="url(#fua4d6lni00q4)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="317" x="1534.5" y="2073.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="298" x="1540.5" y="2089.9185">ASPSP reports consent authorization OK</text><polygon fill="#FF00FF" points="254.5,2124.1172,244.5,2128.1172,254.5,2132.1172,250.5,2128.1172" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="248.5" x2="3351.5" y1="2128.1172" y2="2128.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="34" x="260.5" y="2123.0513">Done</text><polygon fill="#FF00FF" points="542.5,2153.25,532.5,2157.25,542.5,2161.25,538.5,2157.25" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="536.5" x2="3351.5" y1="2157.25" y2="2157.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="548.5" y="2152.1841">GET /from/aspsp/ok webhook</text><polygon fill="#FF00FF" points="928,2182.3828,938,2186.3828,928,2190.3828,932,2186.3828" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="531.5" x2="934" y1="2186.3828" y2="2186.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="538.5" y="2181.3169">fromAspspOkUsingGET</text><polygon fill="#FF00FF" points="1310,2211.5156,1320,2215.5156,1310,2219.5156,1314,2215.5156" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="940" x2="1316" y1="2215.5156" y2="2215.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="947" y="2210.4497">Facade.execute()</text><polygon fill="#FF00FF" points="1563,2240.6484,1573,2244.6484,1563,2248.6484,1567,2244.6484" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="1322" x2="1569" y1="2244.6484" y2="2244.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="1329" y="2239.5825">Create facade context from request</text><polygon fill="#FF00FF" points="1333,2269.7813,1323,2273.7813,1333,2277.7813,1329,2273.7813" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="1327" x2="1574" y1="2273.7813" y2="2273.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="1339" y="2268.7153">ServiceContext</text><polygon fill="#FF00FF" points="1728,2298.9141,1738,2302.9141,1728,2306.9141,1732,2302.9141" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="1322" x2="1734" y1="2302.9141" y2="2302.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="343" x="1329" y="2297.8481">Select bank protocol by using authorization session id</text><polygon fill="#FF00FF" points="1440,2328.0469,1430,2332.0469,1440,2336.0469,1436,2332.0469" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="1434" x2="1739" y1="2332.0469" y2="2332.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="1446" y="2326.981">Read authorization session</text><polygon fill="#FF00FF" points="1728,2357.1797,1738,2361.1797,1728,2365.1797,1732,2361.1797" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="1429" x2="1734" y1="2361.1797" y2="2361.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="1436" y="2356.1138">Bank protocol id from authorization session</text><polygon fill="#FF00FF" points="1333,2386.3125,1323,2390.3125,1333,2394.3125,1329,2390.3125" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="1327" x2="1739" y1="2390.3125" y2="2390.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="1339" y="2385.2466">BankProtocol</text><polygon fill="#FF00FF" points="1835,2415.4453,1845,2419.4453,1835,2423.4453,1839,2419.4453" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="1322" x2="1841" y1="2419.4453" y2="2419.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="429" x="1329" y="2414.3794">Find bean - Bean(BankProtocol.protocolBeanName) extends Action</text><polygon fill="#FF00FF" points="1333,2444.5781,1323,2448.5781,1333,2452.5781,1329,2448.5781" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="1327" x2="1846" y1="2448.5781" y2="2448.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="1339" y="2443.5122">It is Xs2aFromAspspRedirect service bean</text><polygon fill="#FF00FF" points="2938,2473.7109,2948,2477.7109,2938,2481.7109,2942,2477.7109" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="2587" x2="2944" y1="2477.7109" y2="2477.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="2594" y="2472.645">Bank approved consent</text><polygon fill="#FF00FF" points="1440,2502.8438,1430,2506.8438,1440,2510.8438,1436,2506.8438" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="1434" x2="2949" y1="2506.8438" y2="2506.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="1446" y="2501.7778">Persist consent and its context</text><polygon fill="#FF00FF" points="2598,2531.9766,2588,2535.9766,2598,2539.9766,2594,2535.9766" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="2592" x2="2949" y1="2535.9766" y2="2535.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="2604" y="2530.9106">Consent acquired</text><polygon fill="#FF00FF" points="3238,2561.1094,3248,2565.1094,3238,2569.1094,3242,2565.1094" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="2587" x2="3244" y1="2565.1094" y2="2565.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="2594" y="2560.0435">Translate 'Consent acquired'</text><polygon fill="#FF00FF" points="2598,2590.2422,2588,2594.2422,2598,2598.2422,2594,2594.2422" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="2592" x2="3249" y1="2594.2422" y2="2594.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="2604" y="2589.1763">ConsentAcquiredResult</text><polygon fill="#FF00FF" points="1333,2619.375,1323,2623.375,1333,2627.375,1329,2623.375" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="1327" x2="2586" y1="2623.375" y2="2623.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="1339" y="2618.3091">ConsentAcquiredResult</text><polygon fill="#FF00FF" points="1962,2648.5078,1972,2652.5078,1962,2656.5078,1966,2652.5078" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="1322" x2="1968" y1="2652.5078" y2="2652.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="372" x="1329" y="2647.4419">Translate ConsentAcquiredResult -&gt; FacadeRedirectResult</text><polygon fill="#FF00FF" points="1143.5,2677.6406,1153.5,2681.6406,1143.5,2685.6406,1147.5,2681.6406" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="740.5" x2="1149.5" y1="2681.6406" y2="2681.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="747.5" y="2676.5747">translate FacadeRedirectResult</text><polygon fill="#FF00FF" points="751.5,2706.7734,741.5,2710.7734,751.5,2714.7734,747.5,2710.7734" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="745.5" x2="1154.5" y1="2710.7734" y2="2710.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="757.5" y="2705.7075">This is 303 code with redirection to FinTech</text><polygon fill="#FF00FF" points="542.5,2735.9063,532.5,2739.9063,542.5,2743.9063,538.5,2739.9063" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="536.5" x2="739.5" y1="2739.9063" y2="2739.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="548.5" y="2734.8403">303 Redirect to FinTech</text><polygon fill="#FF00FF" points="254.5,2765.0391,244.5,2769.0391,254.5,2773.0391,250.5,2769.0391" style="stroke: #FF00FF; stroke-width: 1.0;"/><line style="stroke: #FF00FF; stroke-width: 1.0;" x1="248.5" x2="530.5" y1="2769.0391" y2="2769.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="260.5" y="2763.9731">303 FinTech 'Thanks for consent' page</text><rect fill="#EEEEEE" filter="url(#fua4d6lni00q4)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3380" x="3" y="2797.6055"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3383" y1="2797.6055" y2="2797.6055"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3383" y1="2800.6055" y2="2800.6055"/><rect fill="#EEEEEE" filter="url(#fua4d6lni00q4)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="410" x="1488" y="2787.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="391" x="1494" y="2803.106">Fintech receives notification that consent is received</text><polygon fill="#FFA500" points="49.5,2822.1719,39.5,2826.1719,49.5,2830.1719,45.5,2826.1719" style="stroke: #FFA500; stroke-width: 1.0;"/><line style="stroke: #FFA500; stroke-width: 1.0;" x1="43.5" x2="242.5" y1="2826.1719" y2="2826.1719"/><rect fill="#EEEEEE" filter="url(#fua4d6lni00q4)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3380" x="3" y="2854.7383"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3383" y1="2854.7383" y2="2854.7383"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3383" y1="2857.7383" y2="2857.7383"/><rect fill="#EEEEEE" filter="url(#fua4d6lni00q4)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="411" x="1487.5" y="2844.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="392" x="1493.5" y="2860.2388">Fintech calls user account list within same session id</text><polygon fill="#A80036" points="519.5,2909.5703,529.5,2913.5703,519.5,2917.5703,523.5,2913.5703" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="38.5" x2="525.5" y1="2913.5703" y2="2913.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="45.5" y="2893.3716">GET /accounts</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="25" x="49.5" y="2908.5044">with</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="131" x="78.5" y="2908.5044">service session id</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="213.5" y="2908.5044">and Fintech user info, bank id, etc.</text><polygon fill="#A80036" points="728.5,2938.7031,738.5,2942.7031,728.5,2946.7031,732.5,2942.7031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="531.5" x2="734.5" y1="2942.7031" y2="2942.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="538.5" y="2937.6372">getAccounts</text><polygon fill="#A80036" points="1310,2967.8359,1320,2971.8359,1310,2975.8359,1314,2971.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="740.5" x2="1316" y1="2971.8359" y2="2971.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="747.5" y="2966.77">Facade.execute()</text><polygon fill="#A80036" points="1563,2996.9688,1573,3000.9688,1563,3004.9688,1567,3000.9688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1322" x2="1569" y1="3000.9688" y2="3000.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="1329" y="2995.9028">Create facade context from request</text><polygon fill="#A80036" points="1333,3026.1016,1323,3030.1016,1333,3034.1016,1329,3030.1016" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1327" x2="1574" y1="3030.1016" y2="3030.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="1339" y="3025.0356">ServiceContext</text><polygon fill="#A80036" points="1728,3055.2344,1738,3059.2344,1728,3063.2344,1732,3059.2344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1322" x2="1734" y1="3059.2344" y2="3059.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="328" x="1329" y="3054.1685">Select bank protocol from request type and bank id</text><polygon fill="#A80036" points="1333,3084.3672,1323,3088.3672,1333,3092.3672,1329,3088.3672" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1327" x2="1739" y1="3088.3672" y2="3088.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="1339" y="3083.3013">BankProtocol</text><polygon fill="#A80036" points="1835,3113.5,1845,3117.5,1835,3121.5,1839,3117.5" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1322" x2="1841" y1="3117.5" y2="3117.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="429" x="1329" y="3112.4341">Find bean - Bean(BankProtocol.protocolBeanName) extends Action</text><polygon fill="#A80036" points="1333,3142.6328,1323,3146.6328,1333,3150.6328,1329,3146.6328" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1327" x2="1846" y1="3146.6328" y2="3146.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="1339" y="3141.5669">It is Xs2aListAccountsEntrypoint service bean</text><polygon fill="#A80036" points="2163,3171.7656,2173,3175.7656,2163,3179.7656,2167,3175.7656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1322" x2="2169" y1="3175.7656" y2="3175.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="339" x="1329" y="3170.6997">Xs2aListAccountsEntrypoint.execute(ServiceContext)</text><polygon fill="#A80036" points="1440,3200.8984,1430,3204.8984,1440,3208.8984,1436,3204.8984" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1434" x2="2174" y1="3204.8984" y2="3204.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="1446" y="3199.8325">Consent for service session</text><polygon fill="#A80036" points="2163,3230.0313,2173,3234.0313,2163,3238.0313,2167,3234.0313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1429" x2="2169" y1="3234.0313" y2="3234.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="1436" y="3228.9653">Consent present,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="1550" y="3228.9653">consent context</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="2950" x2="2992" y1="3278.2969" y2="3278.2969"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2992" x2="2992" y1="3278.2969" y2="3291.2969"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2951" x2="2992" y1="3291.2969" y2="3291.2969"/><polygon fill="#A80036" points="2961,3287.2969,2951,3291.2969,2961,3295.2969,2957,3291.2969" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="2957" y="3258.0981">Validate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="3013" y="3258.0981">consent context</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="3135" y="3258.0981">-</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="2957" y="3273.231">do we have enough data (Mocked execution)</text><polygon fill="#A80036" points="3340.5,3316.4297,3350.5,3320.4297,3340.5,3324.4297,3344.5,3320.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2950" x2="3346.5" y1="3320.4297" y2="3320.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="2957" y="3315.3638">Call ASPSP with consent using</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="3153" y="3315.3638">consent context</text><polygon fill="#A80036" points="2961,3345.5625,2951,3349.5625,2961,3353.5625,2957,3349.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2955" x2="3351.5" y1="3349.5625" y2="3349.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="2967" y="3344.4966">Users' accounts</text><polygon fill="#A80036" points="3238,3374.6953,3248,3378.6953,3238,3382.6953,3242,3378.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2950" x2="3244" y1="3378.6953" y2="3378.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="2957" y="3373.6294">Translate ASPSP response</text><polygon fill="#A80036" points="2798,3403.8281,2788,3407.8281,2798,3411.8281,2794,3407.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2792" x2="3249" y1="3407.8281" y2="3407.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="2804" y="3402.7622">Translate ASPSP response</text><polygon fill="#A80036" points="3238,3432.9609,3248,3436.9609,3238,3440.9609,3242,3436.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2787" x2="3244" y1="3436.9609" y2="3436.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="74" x="2794" y="3431.895">Account list</text><polygon fill="#A80036" points="2186,3446.9609,2176,3450.9609,2186,3454.9609,2182,3450.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2180" x2="3249" y1="3450.9609" y2="3450.9609"/><polygon fill="#A80036" points="1333,3476.0938,1323,3480.0938,1333,3484.0938,1329,3480.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1327" x2="2174" y1="3480.0938" y2="3480.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="1339" y="3475.0278">SuccessResult&lt;Account list&gt;</text><polygon fill="#A80036" points="1333,3505.2266,1323,3509.2266,1333,3513.2266,1329,3509.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1327" x2="2586" y1="3509.2266" y2="3509.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="1339" y="3504.1606">SuccessResult&lt;Account list&gt;</text><polygon fill="#A80036" points="1962,3534.3594,1972,3538.3594,1962,3542.3594,1966,3538.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1322" x2="1968" y1="3538.3594" y2="3538.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="317" x="1329" y="3533.2935">Translate SuccessResult -&gt; FacadeSuccessResult</text><polygon fill="#A80036" points="751.5,3563.4922,741.5,3567.4922,751.5,3571.4922,747.5,3567.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="745.5" x2="1973" y1="3567.4922" y2="3567.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="757.5" y="3562.4263">process FacadeSuccessResult</text><polygon fill="#A80036" points="1143.5,3592.625,1153.5,3596.625,1143.5,3600.625,1147.5,3596.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="740.5" x2="1149.5" y1="3596.625" y2="3596.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="747.5" y="3591.5591">translate FacadeSuccessResult</text><polygon fill="#A80036" points="751.5,3621.7578,741.5,3625.7578,751.5,3629.7578,747.5,3625.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="745.5" x2="1154.5" y1="3625.7578" y2="3625.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="757.5" y="3620.6919">This is 200 code with Account list body</text><polygon fill="#A80036" points="542.5,3650.8906,532.5,3654.8906,542.5,3658.8906,538.5,3654.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="536.5" x2="739.5" y1="3654.8906" y2="3654.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="548.5" y="3649.8247">200 and Account list</text><polygon fill="#A80036" points="49.5,3680.0234,39.5,3684.0234,49.5,3688.0234,45.5,3684.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="43.5" x2="530.5" y1="3684.0234" y2="3684.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="55.5" y="3678.9575">200 and Account list</text><rect fill="#DDDDDD" height="75.1875" rx="5" ry="5" style="stroke: #000000; stroke-width: 1.0;" width="299" x="11" y="11"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="79" x="17" y="28.9951">Combined</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="242" x="17" y="45.292">embedded (Extra user parameters)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="236" x="17" y="61.5889">and redirect (ASPSP authorization)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="132" x="17" y="77.8857">authorization when</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="147" x="157" y="77.8857">consent is missing</text><!--MD5=[a31b7a3e6f9b6335090fbee6894aa18c]
@startuml
legend top left
  <b>Combined</b>
  embedded (Extra user parameters)
  and redirect (ASPSP authorization)
  authorization when  <b>consent is missing</b>
endlegend

actor FinTech
actor User

collections TppBackend

box "TPP API"
control TppBankingApiAisController
control ConsentServiceController
participant FacadeResponseMapper
endbox

box "OPBA-Facade"
collections FacadeService
database Database
participant ServiceContextProvider
participant ProtocolSelector
participant Spring
participant ProtocolResultHandler
endbox

box "XS2A-Protocol"
participant Xs2aListAccountsEntrypoint
participant Xs2aUpdateAuthorization
participant Xs2aFromAspspRedirect
participant Xs2aResultBodyExtractor
collections Xs2aServices
participant OutcomeMapper
endbox

boundary ASPSP

== FinTech asks for user account list ==
FinTech [#blue]-> TppBackend : GET /accounts\n(Fintech user info, bank id, etc.)
TppBackend [#blue]-> TppBankingApiAisController : getAccounts
TppBankingApiAisController [#blue]-> FacadeService : Facade.execute()
FacadeService [#blue]-> ServiceContextProvider : Create facade context from request
FacadeService <-[#blue] ServiceContextProvider : ServiceContext
FacadeService [#blue]-> ProtocolSelector : Select bank protocol from request type and bank id
ProtocolSelector [#blue]-> FacadeService : BankProtocol
FacadeService [#blue]-> Spring : Find bean - Bean(BankProtocol.protocolBeanName) extends Action
FacadeService <-[#blue] Spring : It is Xs2aListAccountsEntrypoint service bean
FacadeService [#blue]-> Xs2aListAccountsEntrypoint : Xs2aListAccountsEntrypoint.execute(ServiceContext)
Xs2aListAccountsEntrypoint [#blue]-> Xs2aServices
Xs2aServices [#blue]-> Database : Consent for service session
Xs2aServices <-[#blue] Database : No consent
Xs2aServices [#blue]-> Xs2aServices : Validate API input -\ndo we have enough data (Mocked execution)
Xs2aServices [#blue]-> Xs2aListAccountsEntrypoint : ValidationIssue[] -> User input has missing parameters
Xs2aListAccountsEntrypoint [#blue]-> OutcomeMapper : Translate ValidationIssue[]
OutcomeMapper [#blue]-> Xs2aListAccountsEntrypoint : ContextBasedValidationErrorResult
Xs2aListAccountsEntrypoint [#blue]-> FacadeService : ContextBasedValidationErrorResult
FacadeService [#blue]-> ProtocolResultHandler : Translate ContextBasedValidationErrorResult -> FacadeStartAuthorizationResult
ProtocolResultHandler [#blue]-> Database : Authorization session present?
Database [#blue]-> ProtocolResultHandler : No authorization session
ProtocolResultHandler [#blue]-> Database : Create authorization session
ProtocolResultHandler [#blue]-> TppBankingApiAisController : process FacadeStartAuthorizationResult
TppBankingApiAisController [#blue]-> FacadeResponseMapper : translate FacadeStartAuthorizationResult
FacadeResponseMapper [#blue]-> TppBankingApiAisController : This is 202 code with redirection to Embedded authorization
TppBankingApiAisController [#blue]-> TppBackend : 202 Embedded authorization
TppBackend [#blue]-> FinTech : 202 Embedded authorization
FinTech [#blue]-> FinTech : Store <b>service session id</b>

FinTech [#orange]-> User : Redirect user to\n'Embedded authorization'\nform using 'Location' header

== User authorizes this request (embedded to provide i.e. PSU id) ==
loop Until user input has not enough parameters
User [#green]-> TppBackend : POST /consent/embedded\n(Consent valid until, which accounts, etc.)
TppBackend [#green]-> ConsentServiceController : embeddedUsingPOST
ConsentServiceController [#green]-> FacadeService : Facade.execute()
FacadeService [#green]-> ServiceContextProvider : Create facade context from request
FacadeService <-[#green] ServiceContextProvider : ServiceContext
FacadeService [#green]-> ProtocolSelector : Select bank protocol by using authorization session id
ProtocolSelector [#green]-> Database : Read authorization session
Database [#green]-> ProtocolSelector: Bank protocol id from authorization session
ProtocolSelector [#green]-> FacadeService : BankProtocol
FacadeService [#green]-> Spring : Find bean - Bean(BankProtocol.protocolBeanName) extends Action
FacadeService <-[#green] Spring : It is Xs2aUpdateAuthorization service bean
Xs2aUpdateAuthorization [#green]-> Xs2aServices : Update context with users' input
end
Xs2aServices [#green]-> Xs2aServices : User input OK
Xs2aServices [#green]-> Xs2aServices : Switch to real execution mode
Xs2aServices [#green]-> ASPSP : Initiate consent
ASPSP [#green]-> Xs2aServices : Redirect authorization required
Xs2aServices [#green]-> Xs2aListAccountsEntrypoint : Redirect to ASPSP required
Xs2aListAccountsEntrypoint [#green]-> OutcomeMapper : Translate 'Redirect to ASPSP required'
OutcomeMapper [#green]-> Xs2aListAccountsEntrypoint : ContextBasedAuthorizationRequiredResult
Xs2aListAccountsEntrypoint [#green]-> FacadeService : ContextBasedAuthorizationRequiredResult
FacadeService [#green]-> ProtocolResultHandler : Translate FacadeStartAuthorizationResult -> FacadeRedirectResult
TppBankingApiAisController [#green]-> FacadeResponseMapper : translate FacadeRedirectResult
FacadeResponseMapper [#green]-> TppBankingApiAisController : This is 303 code with redirection to ASPSP authorization page
TppBankingApiAisController [#green]-> TppBackend : 303 Redirect to ASPSP
TppBackend [#green]-> User : 303 ASPSP 'Login page'

== User authorizes this request with ASPSP (redirect) ==
User [#orange]-> ASPSP : Authorization

== ASPSP reports consent authorization OK ==
ASPSP [#magenta]-> User : Done
ASPSP [#magenta]-> TppBackend : GET /from/aspsp/ok webhook
TppBackend [#magenta]-> ConsentServiceController : fromAspspOkUsingGET
ConsentServiceController [#magenta]-> FacadeService : Facade.execute()
FacadeService [#magenta]-> ServiceContextProvider : Create facade context from request
FacadeService <-[#magenta] ServiceContextProvider : ServiceContext
FacadeService [#magenta]-> ProtocolSelector : Select bank protocol by using authorization session id
ProtocolSelector [#magenta]-> Database : Read authorization session
Database [#magenta]-> ProtocolSelector: Bank protocol id from authorization session
ProtocolSelector [#magenta]-> FacadeService : BankProtocol
FacadeService [#magenta]-> Spring : Find bean - Bean(BankProtocol.protocolBeanName) extends Action
FacadeService <-[#magenta] Spring : It is Xs2aFromAspspRedirect service bean
Xs2aFromAspspRedirect [#magenta]-> Xs2aServices : Bank approved consent
Xs2aServices [#magenta]-> Database : Persist consent and its context
Xs2aServices [#magenta]-> Xs2aFromAspspRedirect : Consent acquired
Xs2aFromAspspRedirect [#magenta]-> OutcomeMapper : Translate 'Consent acquired'
OutcomeMapper [#magenta]-> Xs2aFromAspspRedirect : ConsentAcquiredResult
Xs2aFromAspspRedirect [#magenta]-> FacadeService : ConsentAcquiredResult
FacadeService [#magenta]-> ProtocolResultHandler : Translate ConsentAcquiredResult -> FacadeRedirectResult
TppBankingApiAisController [#magenta]-> FacadeResponseMapper : translate FacadeRedirectResult
FacadeResponseMapper [#magenta]-> TppBankingApiAisController : This is 303 code with redirection to FinTech
TppBankingApiAisController [#magenta]-> TppBackend : 303 Redirect to FinTech
TppBackend [#magenta]-> User : 303 FinTech 'Thanks for consent' page

== Fintech receives notification that consent is received ==
User [#orange]-> FinTech

== Fintech calls user account list within same session id ==

FinTech -> TppBackend : GET /accounts\n with <b>service session id</b> and Fintech user info, bank id, etc.
TppBackend -> TppBankingApiAisController : getAccounts
TppBankingApiAisController -> FacadeService : Facade.execute()
FacadeService -> ServiceContextProvider : Create facade context from request
FacadeService <- ServiceContextProvider : ServiceContext
FacadeService -> ProtocolSelector : Select bank protocol from request type and bank id
ProtocolSelector -> FacadeService : BankProtocol
FacadeService -> Spring : Find bean - Bean(BankProtocol.protocolBeanName) extends Action
FacadeService <- Spring : It is Xs2aListAccountsEntrypoint service bean
FacadeService -> Xs2aListAccountsEntrypoint : Xs2aListAccountsEntrypoint.execute(ServiceContext)
Xs2aListAccountsEntrypoint -> Database : Consent for service session
Xs2aListAccountsEntrypoint <- Database : Consent present, <b>consent context</b>
Xs2aServices -> Xs2aServices : Validate <b>consent context</b> -\ndo we have enough data (Mocked execution)
Xs2aServices -> ASPSP : Call ASPSP with consent using <b>consent context</b>
ASPSP -> Xs2aServices : Users' accounts
Xs2aServices -> OutcomeMapper : Translate ASPSP response
OutcomeMapper -> Xs2aResultBodyExtractor : Translate ASPSP response
Xs2aResultBodyExtractor -> OutcomeMapper : Account list
OutcomeMapper -> Xs2aListAccountsEntrypoint
Xs2aListAccountsEntrypoint -> FacadeService : SuccessResult<Account list>
Xs2aFromAspspRedirect -> FacadeService : SuccessResult<Account list>
FacadeService -> ProtocolResultHandler : Translate SuccessResult -> FacadeSuccessResult
ProtocolResultHandler -> TppBankingApiAisController : process FacadeSuccessResult
TppBankingApiAisController -> FacadeResponseMapper : translate FacadeSuccessResult
FacadeResponseMapper -> TppBankingApiAisController : This is 200 code with Account list body
TppBankingApiAisController -> TppBackend : 200 and Account list
TppBackend -> FinTech : 200 and Account list
@enduml

PlantUML version 1.2019.11(Sun Sep 22 13:02:15 EEST 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_232-release-1638-b6
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>
