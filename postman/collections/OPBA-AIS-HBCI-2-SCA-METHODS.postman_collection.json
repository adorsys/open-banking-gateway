{
	"info": {
		"_postman_id": "551e4490-c406-4ea5-b48d-2728c55fa35e",
		"name": "OPBA-AIS-HBCI-2-SCA-METHODS",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "01. [FINTECH] Search bank by name",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Success', function() {",
							"    pm.response.to.have.status(200)",
							"})",
							"",
							"pm.environment.set(\"bank-id\", pm.response.json().bankDescriptor[0].uuid)"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "X-Request-ID",
						"value": "{{x-request-id}}",
						"type": "text"
					},
					{
						"key": "X-Request-Signature",
						"value": "{{x-request-signature}}",
						"type": "text"
					},
					{
						"key": "Fintech-ID",
						"value": "{{fintech-id}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{opba-base}}/v1/banking/search/bank-search?keyword=adorsys%20embedded",
					"host": [
						"{{opba-base}}"
					],
					"path": [
						"v1",
						"banking",
						"search",
						"bank-search"
					],
					"query": [
						{
							"key": "keyword",
							"value": "adorsys%20embedded"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "02. [FINTECH] Get users account list (without consent)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Success', function() {",
							"    pm.response.to.have.status(202)",
							"})",
							"",
							"pm.environment.set(\"service-session-id\", pm.response.headers.get('Service-Session-ID'))",
							"pm.environment.set(\"authorization-session-id\", pm.response.headers.get('Authorization-Session-ID'))",
							"pm.environment.set(\"redirect-code\", pm.response.headers.get('Redirect-Code'))",
							"pm.environment.set(\"fintech-user-temp-password\", pm.response.headers.get(\"Location\").split(\"redirectCode=\")[1])"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"var uuid = require('uuid')",
							"pm.environment.set(\"fintech-user-id\", uuid.v4())"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "X-Request-ID",
						"type": "text",
						"value": "{{x-request-id}}"
					},
					{
						"key": "X-Request-Signature",
						"type": "text",
						"value": "{{x-request-signature}}"
					},
					{
						"key": "Fintech-ID",
						"type": "text",
						"value": "{{fintech-id}}"
					},
					{
						"key": "Fintech-Redirect-URL-OK",
						"value": "https://google.com?q=OK",
						"type": "text"
					},
					{
						"key": "Fintech-Redirect-URL-NOK",
						"value": "https://google.com?q=NOK",
						"type": "text"
					},
					{
						"key": "Fintech-User-ID",
						"value": "{{fintech-user-id}}",
						"type": "text"
					},
					{
						"key": "Service-Session-Password",
						"value": "{{service-session-password}}",
						"type": "text"
					},
					{
						"key": "Bank-ID",
						"value": "{{bank-id}}",
						"type": "text"
					},
					{
						"key": "PSU-IP-Address",
						"value": "1.1.1.1",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{opba-base}}/v1/banking/ais/accounts",
					"host": [
						"{{opba-base}}"
					],
					"path": [
						"v1",
						"banking",
						"ais",
						"accounts"
					]
				}
			},
			"response": []
		},
		{
			"name": "03. [CONSENT-UI] (Optional) Register PSU (accounts holder) in OpenBanking",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Success', function() {",
							"    pm.expect(pm.response.code).to.be.oneOf([201, 400]); // 400: user may exist - OK",
							"})"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "X-Request-ID",
						"type": "text",
						"value": "{{x-request-id}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"login\":\"{{psu-login}}\", \"password\":\"{{psu-password}}\"}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{opba-base}}/v1/psu/register",
					"host": [
						"{{opba-base}}"
					],
					"path": [
						"v1",
						"psu",
						"register"
					]
				}
			},
			"response": []
		},
		{
			"name": "04.  [CONSENT-UI] PSU logs in to OpenBanking",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Success', function() {",
							"    pm.response.to.have.status(202)",
							"})",
							"",
							"pm.environment.set(\"session-cookie\", pm.response.headers.get('Set-Cookie'))"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "X-Request-ID",
						"value": "{{x-request-id}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"login\":\"{{psu-login}}\", \"password\":\"{{psu-password}}\"}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{opba-base}}/v1/psu/{{authorization-session-id}}/for-approval/login?redirectCode={{fintech-user-temp-password}}",
					"host": [
						"{{opba-base}}"
					],
					"path": [
						"v1",
						"psu",
						"{{authorization-session-id}}",
						"for-approval",
						"login"
					],
					"query": [
						{
							"key": "redirectCode",
							"value": "{{fintech-user-temp-password}}"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "05. [CONSENT-UI] Get current consent authorization state",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Success', function() {",
							"    pm.response.to.have.status(202)",
							"})",
							"",
							"pm.environment.set(\"redirect-code\", pm.response.headers.get('Redirect-Code'))"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Cookie",
						"value": "{{session-cookie}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{opba-base}}/v1/consent/{{authorization-session-id}}?redirectCode={{redirect-code}}",
					"host": [
						"{{opba-base}}"
					],
					"path": [
						"v1",
						"consent",
						"{{authorization-session-id}}"
					],
					"query": [
						{
							"key": "redirectCode",
							"value": "{{redirect-code}}"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "07. [CONSENT-UI]  Provide PSU ID as was required on step #05",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Success', function() {",
							"    pm.response.to.have.status(202)",
							"})",
							"",
							"pm.environment.set(\"redirect-code\", pm.response.headers.get('Redirect-Code'))"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Cookie",
						"type": "text",
						"value": "{{session-cookie}}"
					},
					{
						"key": "X-Request-ID",
						"value": "{{x-request-id}}",
						"type": "text"
					},
					{
						"key": "X-Xsrf-Token",
						"value": "a8b24683-242a-428b-8295-2f4805bb0a30",
						"description": "Deprecated field",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"extras\":{\"PSU_ID\":\"max.musterman\"}}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{opba-base}}/v1/consent/{{authorization-session-id}}/embedded?redirectCode={{redirect-code}}",
					"host": [
						"{{opba-base}}"
					],
					"path": [
						"v1",
						"consent",
						"{{authorization-session-id}}",
						"embedded"
					],
					"query": [
						{
							"key": "redirectCode",
							"value": "{{redirect-code}}"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "08. [CONSENT-UI] Provide PSU pin",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Success', function() {",
							"    pm.response.to.have.status(202)",
							"})",
							"",
							"pm.environment.set(\"redirect-code\", pm.response.headers.get('Redirect-Code'))"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Cookie",
						"type": "text",
						"value": "{{session-cookie}}"
					},
					{
						"key": "X-Request-ID",
						"value": "{{x-request-id}}",
						"type": "text"
					},
					{
						"key": "X-Xsrf-Token",
						"value": "a8b24683-242a-428b-8295-2f4805bb0a30",
						"description": "Deprecated field",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"scaAuthenticationData\":{\"PSU_PASSWORD\":\"12345\"}}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{opba-base}}/v1/consent/{{authorization-session-id}}/embedded?redirectCode={{redirect-code}}",
					"host": [
						"{{opba-base}}"
					],
					"path": [
						"v1",
						"consent",
						"{{authorization-session-id}}",
						"embedded"
					],
					"query": [
						{
							"key": "redirectCode",
							"value": "{{redirect-code}}"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "09. [CONSENT-UI] List available SCA challenges",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Success', function() {",
							"    pm.response.to.have.status(202)",
							"})",
							"",
							"pm.environment.set(\"sca-challenge-id\", pm.response.json().scaMethods[0].id)",
							"pm.environment.set(\"redirect-code\", pm.response.headers.get('Redirect-Code'))"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Cookie",
						"value": "{{session-cookie}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{opba-base}}/v1/consent/{{authorization-session-id}}?redirectCode={{redirect-code}}",
					"host": [
						"{{opba-base}}"
					],
					"path": [
						"v1",
						"consent",
						"{{authorization-session-id}}"
					],
					"query": [
						{
							"key": "redirectCode",
							"value": "{{redirect-code}}"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "09. [CONSENT-UI] Select SCA challenge",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Success', function() {",
							"    pm.response.to.have.status(202)",
							"})",
							"",
							"pm.environment.set(\"redirect-code\", pm.response.headers.get('Redirect-Code'))"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Cookie",
						"type": "text",
						"value": "{{session-cookie}}"
					},
					{
						"key": "X-Request-iD",
						"value": "{{x-request-id}}",
						"type": "text"
					},
					{
						"key": "X-Xsrf-Token",
						"value": "a8b24683-242a-428b-8295-2f4805bb0a30",
						"description": "Deprecated field",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"scaAuthenticationData\":{\"SCA_CHALLENGE_ID\":\"{{sca-challenge-id}}\"}}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{opba-base}}/v1/consent/{{authorization-session-id}}/embedded?redirectCode={{redirect-code}}",
					"host": [
						"{{opba-base}}"
					],
					"path": [
						"v1",
						"consent",
						"{{authorization-session-id}}",
						"embedded"
					],
					"query": [
						{
							"key": "redirectCode",
							"value": "{{redirect-code}}"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "11. [CONSENT-UI] Get current consent state (finished)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Success', function() {",
							"    pm.response.to.have.status(202)",
							"})",
							"",
							"pm.environment.set(\"redirect-code\", pm.response.headers.get('Redirect-Code'))"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Cookie",
						"value": "{{session-cookie}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{opba-base}}/v1/consent/{{authorization-session-id}}?redirectCode={{redirect-code}}",
					"host": [
						"{{opba-base}}"
					],
					"path": [
						"v1",
						"consent",
						"{{authorization-session-id}}"
					],
					"query": [
						{
							"key": "redirectCode",
							"value": "{{redirect-code}}"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "12. [FINTECH] Confirm PSU consent grant (redirect back to FinTech confirmation)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Success', function() {",
							"    pm.response.to.have.status(200)",
							"})"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "X-Request-ID",
						"type": "text",
						"value": "{{x-request-id}}"
					},
					{
						"key": "X-Request-Signature",
						"type": "text",
						"value": "{{x-request-signature}}"
					},
					{
						"key": "Service-Session-Password",
						"type": "text",
						"value": "{{service-session-password}}"
					}
				],
				"url": {
					"raw": "{{opba-base}}/v1/banking/consents/{{authorization-session-id}}/confirm",
					"host": [
						"{{opba-base}}"
					],
					"path": [
						"v1",
						"banking",
						"consents",
						"{{authorization-session-id}}",
						"confirm"
					]
				}
			},
			"response": []
		},
		{
			"name": "13. [FINTECH] Get users account list with consent",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Success', function() {",
							"    pm.response.to.have.status(200)",
							"    pm.expect(pm.response.json().accounts[0].iban).to.eql(DE38760700240320465700);",
							"})",
							"",
							"pm.environment.set(\"resource-id\", pm.response.json().accounts[0].resourceId)"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "X-Request-ID",
						"type": "text",
						"value": "{{x-request-id}}"
					},
					{
						"key": "X-Request-Signature",
						"type": "text",
						"value": "{{x-request-signature}}"
					},
					{
						"key": "Fintech-ID",
						"type": "text",
						"value": "{{fintech-id}}"
					},
					{
						"key": "Fintech-Redirect-URL-OK",
						"type": "text",
						"value": "https://google.com?q=OK"
					},
					{
						"key": "Fintech-Redirect-URL-NOK",
						"type": "text",
						"value": "https://google.com?q=NOK"
					},
					{
						"key": "Fintech-User-ID",
						"type": "text",
						"value": "{{fintech-user-id}}"
					},
					{
						"key": "Service-Session-Password",
						"type": "text",
						"value": "{{service-session-password}}"
					},
					{
						"key": "Bank-ID",
						"type": "text",
						"value": "{{bank-id}}"
					},
					{
						"key": "Service-Session-ID",
						"value": "{{service-session-id}}",
						"description": "Actually is a consent ID",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{opba-base}}/v1/banking/ais/accounts?online=false",
					"host": [
						"{{opba-base}}"
					],
					"path": [
						"v1",
						"banking",
						"ais",
						"accounts"
					],
					"query": [
						{
							"key": "online",
							"value": "false"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "14. [FINTECH] Get users transaction list with consent",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Success', function() {",
							"    pm.response.to.have.status(200)",
							"})"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "X-Request-ID",
						"type": "text",
						"value": "{{x-request-id}}"
					},
					{
						"key": "X-Request-Signature",
						"type": "text",
						"value": "{{x-request-signature}}"
					},
					{
						"key": "Fintech-ID",
						"type": "text",
						"value": "{{fintech-id}}"
					},
					{
						"key": "Fintech-Redirect-URL-OK",
						"type": "text",
						"value": "https://google.com?q=OK"
					},
					{
						"key": "Fintech-Redirect-URL-NOK",
						"type": "text",
						"value": "https://google.com?q=NOK"
					},
					{
						"key": "Fintech-User-ID",
						"type": "text",
						"value": "{{fintech-user-id}}"
					},
					{
						"key": "Service-Session-Password",
						"type": "text",
						"value": "{{service-session-password}}"
					},
					{
						"key": "Bank-ID",
						"type": "text",
						"value": "{{bank-id}}"
					},
					{
						"key": "PSU-IP-Address",
						"type": "text",
						"value": "1.1.1.1"
					},
					{
						"key": "Service-Session-ID",
						"type": "text",
						"value": "{{service-session-id}}"
					}
				],
				"url": {
					"raw": "{{opba-base}}/v1/banking/ais/accounts/{{resource-id}}/transactions?dateFrom=1970-01-01&dateTo=2099-03-12&bookingStatus=both",
					"host": [
						"{{opba-base}}"
					],
					"path": [
						"v1",
						"banking",
						"ais",
						"accounts",
						"{{resource-id}}",
						"transactions"
					],
					"query": [
						{
							"key": "dateFrom",
							"value": "1970-01-01"
						},
						{
							"key": "dateTo",
							"value": "2099-03-12"
						},
						{
							"key": "bookingStatus",
							"value": "both"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "15. [FINTECH] Delete users' consent",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('Success', function() {",
							"    pm.response.to.have.status(200);",
							"})"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "DELETE",
				"header": [
					{
						"key": "X-Request-ID",
						"type": "text",
						"value": "{{x-request-id}}"
					},
					{
						"key": "X-Request-Signature",
						"type": "text",
						"value": "{{x-request-signature}}"
					},
					{
						"key": "Fintech-ID",
						"type": "text",
						"value": "{{fintech-id}}"
					},
					{
						"key": "Fintech-Redirect-URL-OK",
						"type": "text",
						"value": "https://google.com?q=OK"
					},
					{
						"key": "Fintech-Redirect-URL-NOK",
						"type": "text",
						"value": "https://google.com?q=NOK"
					},
					{
						"key": "Fintech-User-ID",
						"type": "text",
						"value": "{{fintech-user-id}}"
					},
					{
						"key": "Service-Session-Password",
						"type": "text",
						"value": "{{service-session-password}}"
					},
					{
						"key": "Bank-ID",
						"type": "text",
						"value": "{{bank-id}}"
					},
					{
						"key": "Service-Session-ID",
						"value": "{{service-session-id}}",
						"description": "Actually is a consent ID",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{opba-base}}/v1/banking/ais/consents/{{service-session-id}}",
					"host": [
						"{{opba-base}}"
					],
					"path": [
						"v1",
						"banking",
						"ais",
						"consents",
						"{{service-session-id}}"
					]
				}
			},
			"response": []
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	]
}