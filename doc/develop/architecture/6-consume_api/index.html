<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Consume Service - Open Banking Gateway Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Consume Service";
    var mkdocs_page_input_path = "architecture/6-consume_api.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Open Banking Gateway Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Architecture</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../1-loginWithFinTech/">Login with FinTech Application</a>
                </li>
                <li class="">
                    
    <a class="" href="../2-searchBank/">Search bank</a>
                </li>
                <li class="">
                    
    <a class="" href="../3-selectBank/">Select bank</a>
                </li>
                <li class="">
                    
    <a class="" href="../4-initiateAisConsent/">List of Transactions</a>
                </li>
                <li class="">
                    
    <a class="" href="../5-redirectPsuToConsentAPI/">Redirect to Consent Authorization API</a>
                </li>
                <li class="">
                    
    <a class="" href="../5a-psuAuthEmbeddedConsent/">Authorize Consent Embedded Approach</a>
                </li>
                <li class="">
                    
    <a class="" href="../5b-psuAuthRedirectConsent/">Authorize Consent Redirect Approach</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Consume Service</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#consume-api-after-consent-authorization">Consume API after Consent Authorization</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#description">Description</a></li>
        
            <li><a class="toctree-l4" href="#diagram">Diagram</a></li>
        
            <li><a class="toctree-l4" href="#use-cases">Use Cases</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../dictionary/">Dictionary</a>
                </li>
                <li class="">
                    
    <a class="" href="../drafts/">Draft</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../roadmap/">Roadmap</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../ContributionGuidelines/">Contribution guidelines</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../releasenotes/">Release notes</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../version_policy/">Version Policy</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Open Banking Gateway Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Architecture &raquo;</li>
        
      
    
    <li>Consume Service</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/adorsys/open-banking-gateway/edit/master/docs/architecture/6-consume_api.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="consume-api-after-consent-authorization">Consume API after Consent Authorization</h1>
<h2 id="description">Description</h2>
<p>This workflow starts with the redirect link leaving from either <a href="../5b-psuAuthRedirectConsent/">Authorize Consent Redirect Approach</a> or <a href="../5a-psuAuthEmbeddedConsent/">Authorize Consent Embedded Approach</a>. This redirect link will be used by the FinTechApi to retrieve a corresponding Token that can be used to request services on behalf of the PSU.</p>
<p>As long as this token is valid, token will be used to perform corresponding service request on behalf on the PSU. </p>
<h2 id="diagram">Diagram</h2>
<p><img alt="Session diagram" src="https://adorsys.github.io/open-banking-gateway/doc//architecture/diagrams/useCases/6-consume_api.png" />  </p>
<h2 id="use-cases">Use Cases</h2>
<h3 id="bankingservice-010-fintechapifromconsentok">BankingService-010 : FinTechApi.fromConsentOk</h3>
<p>The redirect request coming from the <a href="../dictionary/#ConsentAuthorisationApi">ConsentAuthorisationApi</a> contains a redirectCode. This request will be forwarded by the FinTechApi to the TppBankingApi. The request contains following information:</p>
<h4 id="redirectcode">redirectCode</h4>
<p>Available in the redirect url. This information will be used to retrieve the authorization token from the TppBankingApi. So the information needs not be processed by the FinTechApi</p>
<h4 id="fintechconsentsessioncookie">FinTechConsentSessionCookie</h4>
<p>Available in the request header. This cookie shall be set for the Max time given to the PSU for the authorization of the corresponding consent. The cookie can be bound to the end point FinTechApi.fromConsentOk so it does not need to be transported to the server on other requests.</p>
<h4 id="fintechconsentsessionstate">finTechConsentSessionState</h4>
<p>Available in the redirect url. Will be used to read and validate the corresponding FinTechConsentSessionCookie.</p>
<h3 id="bankingservice-020-validate-the-redirectlink">BankingService-020 : Validate the redirectLink</h3>
<p>The finTechConsentSessionState will be used to read and validate the corresponding FinTechConsentSessionCookie. </p>
<h3 id="bankingservice-030-tppbankingapicode2token">BankingService-030 : TppBankingApi.code2Token</h3>
<p>This end point is invoked by the FinTechApi to retrieve token used to send subsequent service requests to the TppBankingApi. We call this token PsuConsentSession.</p>
<h3 id="bankingservice-040-bankingprotocolcode2token">BankingService-040 : BankingProtocol.code2Token</h3>
<p>Forward request to banking protocol.</p>
<h3 id="bankingservice-050-storepsuconsent">BankingService-050 : storePsuConsent</h3>
<p>The returned PsuConsentSession is stored by the FinTechApi for future use. </p>
<h3 id="bankingservice-060-bankingservice-067-service-requests">BankingService-060 .. BankingService-067 Service Requests</h3>
<p>The returned token is used to invoke the service request (ListTransactions). Service result is returned to the FinTechApi and displayed to the PSU.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../dictionary/" class="btn btn-neutral float-right" title="Dictionary">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../5b-psuAuthRedirectConsent/" class="btn btn-neutral" title="Authorize Consent Redirect Approach"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/adorsys/open-banking-gateway/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../5b-psuAuthRedirectConsent/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../dictionary/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
